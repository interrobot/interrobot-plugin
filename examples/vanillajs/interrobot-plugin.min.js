(()=>{var p=class{static getDocument(t){t=t.replace(p.styleAttributeRegex,"");try{return new DOMParser().parseFromString(t,"text/html")}catch(e){console.warn(e)}}static getDocumentCleanText(t){let e=this.getDocument(t);e===null&&(e=new Document);let s=e.querySelectorAll("script, style, svg, noscript, iframe");for(let a=s.length-1;a>=0;a--)s[a].parentElement.removeChild(s[a]);return e}static getDocumentCleanTextIterator(t){let e=p.getDocumentCleanText(t),s="//text() | //meta[@name='description']/@content | //@alt";return e.evaluate(s,e,null,XPathResult.ANY_TYPE,null)}static getElementTextIterator(t,e){let s=".//text()";return t.evaluate(s,e,null,XPathResult.ANY_TYPE,null)}static getElementTextOnly(t,e){let s=p.getElementTextIterator(t,e),a=[],o=s.iterateNext();for(;o;)a.push(o.nodeValue.trim()),o=s.iterateNext();return a.join(" ")}static isUrl(t){return URL.canParse(t)}static htmlEncode(t){return new Option(t).innerHTML}};p.urlsRegex=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-_\:]*)?\??(?:[\-\+=&;%@\.\w_]*)#?(?:[\.\!\/\\\w]*))?)/g;p.urlRegex=/^((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-_\:]*)?\??(?:[\-\+=&;%@\.\w_]*)#?(?:[\.\!\/\\\w]*))?)$/;p.styleAttributeRegex=/style\s*=\s*("([^"]*)"|'([^']*)')/gi;var _=class{constructor(){let t=document.body;t.addEventListener("touchstart",e=>{this.proxyToContainer(e)},{passive:!0}),t.addEventListener("touchend",e=>{this.proxyToContainer(e)},{passive:!0}),t.addEventListener("touchmove",e=>{this.proxyToContainer(e)},{passive:!0})}async proxyToContainer(t){var e;let s,a=(e=t.touches)!==null&&e!==void 0?e:t.changedTouches;if(t.touches.length===1)s=t.touches[0];else if(t.changedTouches.length===1)s=t.changedTouches[0];else return;let c={target:"interrobot",data:{reportTouch:{identifier:null,target:null,clientX:s.clientX,clientY:s.clientY,pageX:s.pageX,pageY:s.pageY,screenX:s.screenX,screenY:s.screenY,radiusX:s.radiusX,radiusY:s.radiusY,rotationAngle:s.rotationAngle,force:s.force,eventType:t.type}}};window.parent.postMessage(c,"*")}async touchEnd(t){}async touchMove(t){}};var R;(function(g){g[g.Light=0]="Light",g[g.Dark=1]="Dark"})(R||(R={}));var N=class{constructor(t,e){this.iframeSrc=t,e?this.hostOrigin=e:this.hostOrigin="";let s=new URL(t);t==="about:srcdoc"?this.pluginOrigin="about:srcdoc":this.pluginOrigin=s.origin}getIframeSrc(){return this.iframeSrc}getHostOrigin(){return this.hostOrigin}getPluginOrigin(){return this.pluginOrigin}toString(){return`host = ${this.hostOrigin}; plugin = ${this.pluginOrigin}`}},f=class{static async initialize(t){let e=()=>{let s=new t;return f.postMeta(s.constructor.meta),window.addEventListener("load",()=>f.postContentHeight()),window.addEventListener("resize",()=>f.postContentHeight()),s};return document.readyState==="complete"||document.readyState==="interactive"?e():new Promise(s=>{document.addEventListener("DOMContentLoaded",()=>{s(e())})})}static postContentHeight(t=null){let e=document.querySelector(".main__results"),s=document.body.scrollHeight;if(e&&(s=Number(e.getBoundingClientRect().bottom)),s!==f.contentScrollHeight){let o={target:"interrobot",data:{reportHeight:t&&t>=1?Math.min(t,s):s}};f.routeMessage(o)}}static postOpenResourceLink(t,e){let s={target:"interrobot",data:{reportLink:{openInBrowser:e,resource:t}}};f.routeMessage(s)}static postMeta(t){let e={target:"interrobot",data:{reportMeta:t}};f.routeMessage(e)}static async postApiRequest(t,e){let s=null;return await(async()=>new Promise(o=>{let c=async i=>{var d;if(i===void 0)return;let l=i.data,r=(d=l.data)!==null&&d!==void 0?d:{};if(r&&typeof r=="object"&&r.hasOwnProperty("apiResponse")){let n=r.apiResponse.__meta__.request.method;t===n&&(s=l.data.apiResponse,window.removeEventListener("message",c),o())}},u={target:"interrobot",data:{apiRequest:{method:t,kwargs:e}}};window.addEventListener("message",c),f.routeMessage(u)}))(),s}static logTiming(t,e){let s=(e/1e3).toFixed(3);console.log(`\u{1F916} [${s}s] ${t}`)}static routeMessage(t){let e="";f.connection?(e=f.connection.getHostOrigin(),window.parent.postMessage(t,e)):window.parent.postMessage(t)}constructor(){this.projectId=-1,this.mode=R.Light;let t,e,s;if(this.parentIsOrigin()){let c=window.parent.document.getElementById("report");t=parseInt(c.dataset.project,10),e=parseInt(c.dataset.mode,10),s=c.dataset.origin}else{let c=new URLSearchParams(window.location.search);t=parseInt(c.get("project"),10),e=parseInt(c.get("mode"),10),s=c.get("origin")}if(f.connection=new N(document.location.href,s),isNaN(t)){let c="missing project url argument";throw new Error(c)}this.data=null,this.projectId=t,this.mode=isNaN(e)||e!==1?R.Light:R.Dark,f.contentScrollHeight=0;let a=R[this.mode].toLowerCase();document.body.classList.remove("light","dark"),document.body.classList.add(a);let o=new _}delay(t){return new Promise(e=>setTimeout(e,t))}getMode(){return this.mode}getProjectId(){return this.projectId}getInstanceMeta(){return this.constructor.meta}async initData(t,e){this.data=new T(this.getProjectId(),this.getInstanceMeta(),t,e),await this.data.loadData()}async initAndGetData(t,e){return await this.initData(t,e),this.data}async getProject(){if(this.project===void 0){let t=await k.getApiProject(this.projectId);if(t===null){let e=`project id=${this.projectId} not found`;throw new Error(e)}this.project=t}return this.project}render(t){document.body.innerHTML=t}async index(){let t=await k.getApiProject(this.getProjectId()),e=p.htmlEncode(t.getDisplayTitle()),s=p.htmlEncode(f.meta.title);this.render(`
            <div class="main__heading">
                <div class="main__heading__icon">
                    <img id="projectIcon" src="${t.getImageDataUri()}" alt="Icon for ${e}" />
                </div>
                <div class="main__heading__title">
                    <h1>${s}</h1>
                    <div><span>${e}</span></div>
                </div>
            </div>
            <div class="main__form">
                <p>Welcome, from the index() of the Plugin base-class. This page exists as a placeholder, 
                but in your hands it could be so much more. The Example Report form below will count and 
                present page title terms used across the website, by count.
                It's an example to help get you started.</p>
                <p>If you have any questions, please reach out to the dev via the in-app contact form.</p>
                <form><button>Example Report</button></form>
            </div>
            <div class="main__results"></div>`),document.getElementsByTagName("button")[0].addEventListener("click",async o=>{await this.process()})}async process(){let t=new Map,e,s=async(i,d)=>{let l=i.name.trim().split(/[\s\-â€”]+/g);for(let r of l)if(!d.has(r))d.set(r,1);else{let n=d.get(r);d.set(r,n+1)}},a=this.getProjectId(),o="headers: text/html",c="name",u=new v({project:a,query:o,fields:c,type:C.Any,includeExternal:!1,includeNoRobots:!1});await b.execute(u,e,async i=>{await s(i,t)},!0,!1,"Processing\u2026"),await this.report(t)}async report(t){let e=new Map([...t.entries()].sort((o,c)=>{let u=o[1],i=c[1];return u===i?o[0].toLowerCase().localeCompare(c[0].toLowerCase()):i-u})),s=[];for(let o of e.keys()){let c=e.get(o),u=o.length>24?o.substring(24)+"\u2026":o;s.push(`<tr><td>${p.htmlEncode(u)}</td><td>${c.toLocaleString()}</td></tr>`)}let a=document.querySelector(".main__results");a.innerHTML=s.length===0?"<p>No results found.</p>":`<div><section><table style="max-width:340px">
            <thead><tr><th>Term</th><th>Count</th></tr></thead>
            <tbody>${s.join("")}</tbody>
            </table></section></div>`,f.postContentHeight()}parentIsOrigin(){try{if(!window.parent||window.parent===window)return!1;let t=window.parent.document;return t?!t.hidden:!1}catch{return!1}}};f.meta={title:"InterroBot Base Plugin",category:"Example",version:"1.0",author:"InterroBot",description:`Welcome to InterroBot plugin development. This base-class Plugin can already 
        query the database, draw conclusions, and report back. It's just few tweaks away from being 
        your own creation.

This is the default plugin description. Set meta: {} values
        in the source to update these display values.`};var C;(function(g){g[g.Page=0]="Page",g[g.Asset=1]="Asset",g[g.Any=2]="Any"})(C||(C={}));var V;(function(g){g[g.Id=0]="Id",g[g.Time=1]="Time",g[g.Status=2]="Status",g[g.Url=3]="Url"})(V||(V={}));var z;(function(g){g[g.Ascending=0]="Ascending",g[g.Descending=1]="Descending"})(z||(z={}));var T=class{constructor(t,e,s,a){if(this.meta=e,this.defaultData=s,this.autoformInputs=a,this.project=t,this.data={apiVersion:"1.1",autoform:{}},this.data.autoform===null&&(this.data.autoform=[]),this.data.autoform[this.project]={},a.length>0){let o=async i=>{let d=i.getAttribute("name"),l;i instanceof HTMLSelectElement||i instanceof HTMLTextAreaElement||i.hasAttribute("value")?l=i.value:l=!(i.checked===void 0||i.checked===!1),await this.setAutoformField(d,l)},c=async i=>{let d=i.getAttribute("name"),l=i,r=document.querySelectorAll(`input[type=radio][name=${l.name}]:checked`);if(r.length!==1){console.error("radio control failure");return}let n=r[0].value;await this.setAutoformField(d,n)},u=async i=>{let d=i.getAttribute("name"),l=i,r=document.querySelectorAll(`input[type=checkbox][name=${l.name}]:checked`),n=[];for(let m=0;m<r.length;m++)n.push(r[m].value);let h=n.join("|");await this.setAutoformField(d,h)};for(let i of this.autoformInputs){if(i===null)continue;switch(i.tagName.toLowerCase()){case"input":let l=i;if(l.type=="checkbox"){let h=i,m=document.querySelectorAll(`input[type=checkbox][name=${h.name}]`);m.length===1?l.addEventListener("change",async w=>{await o(l)}):m.length>1&&l.addEventListener("change",async w=>{await u(l)})}else l.type=="radio"?l.addEventListener("change",async h=>{await c(l)}):l.addEventListener("change",async h=>{await o(l)});break;case"textarea":let r=i;r.addEventListener("change",async h=>{await o(r)}),r.addEventListener("input",async h=>{await o(r)});break;case"select":let n=i;n.addEventListener("change",async h=>{await o(n)});break;default:break}}}}async setDataField(t,e,s){this.data[t]!==e&&(this.data[t]=e),s===!0&&await this.updateData()}async getData(){return this.dataLoaded!==null?this.data:(await this.loadData(),this.data)}async loadData(){var t;let e=window.location.href;e==="about:srcdoc"&&(e=`/reports/${window.parent.document.getElementById("report").dataset.report}/`);let s={pluginUrl:e},a=new Date().getTime(),o=await f.postApiRequest("GetPluginData",s),c=new Date().getTime();try{f.logTiming(`Loaded options: ${JSON.stringify(s)}`,c-a);let i=o.data,d=Object.keys(i).length===0,l={};for(let r in this.defaultData){let n=this.defaultData[r];l[r]=this.defaultData[r]}for(let r in i){let n=this.defaultData[r];l[r]=i[r]}d&&(this.data=l,await this.updateData()),this.data=l,this.dataLoaded=new Date}catch{console.warn(`failed to load plugin data @ 
${JSON.stringify(s)}`)}if(this.autoformInputs.length>0){let i={};if(!("autoform"in this.data))this.data.autoform={};else for(let d in this.data.autoform)isNaN(parseInt(d,10))&&delete this.data.autoform[d];this.project in this.data.autoform||(this.data.autoform[this.project]=i)}let u=[];for(let i of this.autoformInputs){if(i===null)continue;let d=i.name,l=(t=this.data.autoform[this.project][d])!==null&&t!==void 0?t:null,r=i.tagName.toLowerCase(),n,h=!1,m=!1,w=!1,E=!1,y=!1;switch(r){case"input":n=i,n.type==="radio"?(w=!0,u.push(d)):n.type==="checkbox"&&typeof l=="boolean"?h=!0:n.type==="checkbox"&&typeof l=="string"&&(m=!0);break;case"textarea":n=i,y=!0;break;case"select":n=i,E=!0;break;default:break}if(!n){console.warn("autoform: no input found");return}switch(!0){case w:n.checked=l===n.value;break;case h:n.checked=l||!1;break;case m:n.checked=l?l.toString().indexOf(n.value)>=0:!1;break;case y:n.value=l||"";break;case E:default:l&&(n.value=l);break}}u.forEach(i=>{if(!(document.querySelector(`input[name=${i}]:checked`)!==null)){let l=document.querySelector(`input[name=${i}]`);l&&(l.checked=!0)}})}async setAutoformField(t,e){var s,a;let c=(s=(await this.getData()).autoform)!==null&&s!==void 0?s:{},u=(a=c[this.project])!==null&&a!==void 0?a:{};u[t]!==e&&(u[t]=e,await this.setDataField("autoform",c,!0))}async updateData(){let t=await this.getData();t.meta=this.meta;let e={pluginUrl:window.location.href,pluginData:t},s=await f.postApiRequest("SetPluginData",e)}getDataSlug(){let t=this.getPluginUrl();return btoa(t)}getPluginUrl(){return`${window.location.protocol}//${window.location.host}${window.location.pathname}`}},v=class{constructor({project:t,query:e,fields:s,type:a,includeExternal:o,includeNoRobots:c,sort:u,perPage:i}){this.includeExternal=!0,this.includeNoRobots=!1,this.project=t,this.query=e,this.fields=s,this.type=a,this.includeExternal=o!=null?o:!0,this.includeNoRobots=c!=null?c:!1,this.perPage=i!=null?i:v.maxPerPage,v.validSorts.indexOf(u)>=0?this.sort=u:this.sort=v.validSorts[1]}getHaystackCacheKey(){return`${this.project}~${this.fields}~${this.type}~${this.includeExternal}~${this.includeNoRobots}`}};v.maxPerPage=100;v.validSorts=["?","id","-id","time","-time","status","-status","url","-url"];var b=class{static async execute(t,e,s,a=!1,o=!0,c="Processing..."){let u=new Date().getTime();if(t.getHaystackCacheKey()===b.resultsHaystackCacheKey&&e){let n=e.size;if(o===!1){let m=new CustomEvent("ProcessingMessage",{detail:{action:"set",message:c}});document.dispatchEvent(m)}await b.sleep(16);let h=0;if(await e.forEach(async(m,w)=>{await s(m)}),f.logTiming(`Processed ${n.toLocaleString()} search result(s)`,new Date().getTime()-u),o===!1){let m={detail:{action:"clear"}},w=new CustomEvent("ProcessingMessage",m);document.dispatchEvent(w)}return!0}else b.resultsHaystackCacheKey=t.getHaystackCacheKey(),b.resultsCacheTotal=0;let i={project:t.project,query:t.query,external:t.includeExternal,type:C[t.type].toLowerCase(),offset:0,fields:t.fields.split("|"),norobots:t.includeNoRobots,sort:t.sort,perpage:t.perPage},d=await f.postApiRequest("GetResources",i),l=d.__meta__.results.total;b.resultsCacheTotal=l;let r=d.results;for(let n=0;n<r.length;n++){let h=r[n];await b.handleResult(h,l,s)}for(;d.__meta__.results.pagination.nextOffset!==null&&a===!0;){let n=d.__meta__.results.pagination.nextOffset;i.offset=n,d=await f.postApiRequest("GetResources",i),r=d.results;for(let h=0;h<r.length;h++){let m=r[h];await b.handleResult(m,l,s)}}return f.logTiming(`Loaded/processed ${l.toLocaleString()} search result(s)`,new Date().getTime()-u),!1}static async sleep(t){return new Promise(e=>setTimeout(()=>e(),t))}static async handleResult(t,e,s){let a=new x(t);await s(a);let o=a.result,c=new CustomEvent("SearchResultHandled",{detail:{resultNum:o,resultTotal:e}});document.dispatchEvent(c)}},x=class{static normalizeContentWords(t){let e=[];return t!==""&&e.push.apply(e,t.split(/\s+/)),e}static normalizeContentString(t){return x.normalizeContentWords(t).join(" ")}constructor(t){this.optionalFields=["created","modified","size","status","time","norobots","name","type","content","headers","links","assets","origin"],this.result=t.result,this.id=t.id,this.url=t.url,this.processedContent="";for(let e of this.optionalFields)e in t&&(e==="created"||e==="modified"?this[e]=new Date(t[e]):this[e]=t[e])}hasProcessedContent(){return this.processedContent!=""}getProcessedContent(){return this.processedContent}setProcessedContent(t){this.processedContent=t}getContent(){return this.content}getContentTextOnly(){let t=[],e=null,s=p.getDocumentCleanTextIterator(this.getContent());for(e=s.iterateNext();e!==null;){let o=x.normalizeContentString(e.nodeValue);if(o!==""){let c=o.split(" ").filter(u=>u!=="");c.length>0&&t.push.apply(t,c)}e=s.iterateNext()}let a=t.join(" ");return a=a.replace(x.wordPunctuationRe,""),a=a.replace(x.wordWhitespaceRe," "),a}getHeaders(){return this.headers}getUrlPath(){return new URL(this.url).pathname}clearFulltextFields(){this.content="",this.headers=""}};x.wordPunctuationRe=/\s+(?=[\.,;:!\?] )/g;x.wordWhitespaceRe=/\s+/g;var q=class{constructor(t,e,s,a,o,c,u){this.id=-1,this.created=null,this.modified=null,this.project=-1,this.time=-1,this.report=null,this.id=t,this.created=s,this.modified=a,this.complete=o,this.project=e,this.time=c,this.report=u}getTimings(){return this.getReportDetailByKey("timings")}getSizes(){return this.getReportDetailByKey("sizes")}getCounts(){return this.getReportDetailByKey("counts")}getReportDetailByKey(t){return this.report&&this.report.hasOwnProperty("detail")&&this.report.detail.hasOwnProperty(t)?this.report.detail[t]:null}},k=class{constructor(t,e,s,a,o){this.id=-1,this.created=null,this.modified=null,this.id=t,this.created=e,this.modified=s,this.url=a,this.imageDataUri=o}getImageDataUri(){return this.imageDataUri}getDisplayTitle(){return new URL(this.url).hostname}static async getApiProject(t){let e={projects:[t],fields:["image","created","modified"]},a=(await f.postApiRequest("GetProjects",e)).results;for(let o=0;o<a.length;o++){let c=a[o];if(c.id===t){let u=new Date(c.created),i=new Date(c.modified),d=c.url,l=c.image;return new k(t,u,i,d,l)}}return null}static async getApiCrawls(t){let e={complete:"complete",project:t,fields:["created","modified","report","time"]},s=await f.postApiRequest("GetCrawls",e),a=[],o=s.results;for(let c=0;c<o.length;c++){let u=o[c],i=new q(u.id,t,new Date(u.created),new Date(u.modified),u.complete,u.time,u.report);a.push(i)}return a}};var A=class{static createElement(t,e){let s=new A(e),a=s.getBaseElement();return t&&a?t.appendChild(a):console.warn(`unable to create processing widget: parent [${t}], base [${a}]`),s}constructor(t){this.prefix=t,this.total=0,this.loaded=0,this.active=!0,this.baseElement=document.createElement("div"),this.baseElement.id="processingWidget",this.baseElement.classList.add("processing","hidden"),this.baseElement.innerHTML="",document.addEventListener("SearchResultHandled",async e=>{if(this.active===!1)return;let s=e.detail.resultTotal,a=e.detail.resultNum,o=Math.ceil(a/s*100),c=Math.ceil(this.loaded/this.total*100);if(o>100||c===100){this.baseElement.classList.remove("throbbing");return}this.total=s,this.loaded=a,this.baseElement.innerHTML=o>100?"":`${this.prefix}
                <span class="resultNum">##</span>/<span class="resultTotal">##</span>
                (<span class="percentTotal">##</span>)`;let u=this.baseElement.querySelector(".resultNum");u&&(u.innerText=`${e.detail.resultNum.toLocaleString()}`);let i=this.baseElement.querySelector(".resultTotal");i&&(i.innerText=`${e.detail.resultTotal.toLocaleString()}`);let d=this.baseElement.querySelector(".percentTotal");d&&(d.innerText=`${o}%`),[0,100].indexOf(o)>=0?this.baseElement.classList.remove("throbbing"):this.baseElement.classList.add("throbbing")}),document.addEventListener("ProcessingMessage",async e=>{if(this.active===!1)return;switch(e.detail.action){case"set":this.baseElement.innerHTML="",this.baseElement.innerText=e.detail.message,this.baseElement.classList.add("throbbing");break;case"clear":default:this.baseElement.classList.remove("throbbing");break}})}clearMessage(){this.baseElement.classList.remove("throbbing")}getBaseElement(){return this.baseElement}setPrefix(t){this.prefix=t}setMessage(t){this.baseElement.innerHTML=`${t}`,this.baseElement.classList.add("throbbing")}setActive(t){this.active=t}};var L;(function(g){g[g.Ascending=0]="Ascending",g[g.Descending=1]="Descending"})(L||(L={}));var $=class{constructor(t,e,s,a){this.label=t,this.offset=e,this.limit=s,this.extended=a}};var P=class{static createElement(t,e,s,a,o,c,u,i,d,l,r){let n=new P(e,s,a,o,c,u,i,d,l,r);return t.appendChild(n.baseElement),f.postContentHeight(),n}static generateFormatedColumnNumber(t){return`${t.toString().padStart(2,"0")}.`}static sortResultsHelper(t,e,s,a,o,c,u){return s&&c?u===L.Ascending?e-o:o-e:t!==void 0&&a!==void 0?u===L.Ascending?t.localeCompare(a):a.localeCompare(t):(console.warn(`sort failure: ${t}, ${a}`),0)}constructor(t,e,s,a,o,c,u,i,d,l){this.paginationEdgeRangeDesktop=2,this.paginationEdgeRangeMobile=1,this.baseElement=document.createElement("div"),this.header=s,this.results=o,this.resultsSort=c,this.headings=a,this.perPage=e,this.project=t,this.resultsCount=o.length,this.resultsOffset=0,this.cellRenderer=i,this.rowRenderer=u,this.cellHandler=d,this.exportExtra=l,this.scrollHandler=r=>{var n;let h=r.data;if(h==null){this.setStickyHeaders(0);return}let m=h.data,w=(n=m==null?void 0:m.reportScrollY)!==null&&n!==void 0?n:null;w===null||(h==null?void 0:h.target)!=="interrobot"||this.setStickyHeaders(w)},this.navHandler=r=>{this.resultsOffset=parseInt(r.target.dataset.offset),this.renderSection(),f.postContentHeight()},this.browserLinkHandler=r=>{let n=r.target,h=!0;f.postOpenResourceLink(Number(n.dataset.id),h),r.preventDefault(),r.stopPropagation()},this.appLinkHandler=r=>{let n=r.target,h=!1;f.postOpenResourceLink(Number(n.dataset.id),h),r.preventDefault(),r.stopPropagation()},this.sortableHandler=r=>{if(r.preventDefault(),this.results.length===0)return;let h=r.currentTarget.dataset.heading,m;this.resultsSort.primaryHeading===h?m=this.resultsSort.primarySort===L.Ascending?L.Descending:L.Ascending:m=L.Ascending,this.resultsSort.primaryHeading=h,this.resultsSort.primarySort=m,this.resultsOffset=0,this.sortResults(),this.renderSection();let w={target:"interrobot",data:{reportScrollToTop:!0}};window.parent.postMessage(w,"*")},this.downloadMenuHandler=r=>{let n=this.baseElement.querySelector(".info__dl");n!==null&&(n.classList.toggle("visible"),r.preventDefault())},this.downloadHandler=r=>{var n,h;r.preventDefault(),this.baseElement.querySelector(".info__dl").classList.remove("visible");let w=this.headings.concat(Object.keys((n=this.exportExtra)!==null&&n!==void 0?n:{})),E=!1;w[0]===""&&(E=!0,w.shift());let y=[];for(let S=0;S<this.results.length;S++){let M=this.results[S],j=Object.values((h=this.exportExtra)!==null&&h!==void 0?h:{}),I=[];for(let O of j)if(typeof O=="function"){let F=O(S);I.push(F)}else I.push(O.toString());E?y.push(M.slice(1).concat(I)):y.push(M.concat(I))}let H={target:"interrobot",data:{reportExport:{format:r.target.dataset.format,headers:w,rows:y}}};window.parent.postMessage(H,"*")},this.renderSection()}getHeadingIndex(t){return this.headings.indexOf(t)}getResults(){return this.results}getHeadings(){return this.headings}getResultsSort(){return this.resultsSort}setStickyHeaders(t){let e=this.baseElement.querySelector("thead"),s=e==null?void 0:e.parentElement;if(e===null||s===null)return;let a=s.getBoundingClientRect();a.top<=t&&t<=a.bottom?(e.classList.add("sticky"),e.style.top=`${t-a.top}px`):(e.classList.remove("sticky"),e.style.top="auto")}setOffsetPage(t){let e=t*this.perPage;e!==this.resultsOffset&&(this.resultsOffset=e,this.renderSection())}sortResults(){let t=this.resultsSort.primaryHeading,e=this.resultsSort.primarySort,s=this.getHeadingIndex(t),a=this.resultsSort.secondaryHeading,o=this.resultsSort.secondarySort,c=this.getHeadingIndex(a),u=/^[-+]?[0-9]+([,.]?[0-9]+)?$/;if(s===-1){console.warn(`heading '${this.resultsSort.primaryHeading}' not found, aborting sort`);return}let i=(d,l)=>{let r=d[s],n=u.test(r)?parseFloat(r):null,h=n!==null&&!isNaN(n),m=l[s],w=u.test(m)?parseFloat(m):null,E=w!==null&&!isNaN(w);if(r===m){let y=d[c],H=parseFloat(y),S=!isNaN(H),M=l[c],j=parseFloat(M),I=!isNaN(j);return P.sortResultsHelper(y,H,S,M,j,I,o)}else return P.sortResultsHelper(r,n,h,m,w,E,e)};if(this.results.sort(i),this.headings[0]==="")for(let d=0;d<this.results.length;d++)this.results[d][0]=P.generateFormatedColumnNumber(d+1)}getColumnClass(t){return`column__${t?t.replace(/[^\w]+/g,"").toLowerCase():"empty"}`}renderTableHeadings(t){let e=[],s=`<svg version="1.1" class="chevrons" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
	        x="0px" y="0px" width="12px" height="20px" viewBox="6 2 12 20" enable-background="new 6 2 12 20" xml:space="preserve">
            <title>north/south chevrons</title>
	        <polyline class="d2" fill="none" stroke="#000000" stroke-miterlimit="10" points="7.32,16.655 12.015,21.208 16.566,16.633"/>
	        <polyline class="d1" fill="none" stroke="#000000" stroke-miterlimit="10" points="7.314,13.274 12.01,17.827 16.561,13.253"/>
	        <polyline class="u2" fill="none" stroke="#000000" stroke-miterlimit="10" points="16.685,10.594 12.115,6.041 7.439,10.615"/>
	        <polyline class="u1" fill="none" stroke="#000000" stroke-miterlimit="10" points="16.679,7.345 12.11,2.792 7.434,7.365"/>
        </svg>`;for(let a of t){let o=p.htmlEncode(this.getColumnClass(a)),c=`${p.htmlEncode(a)}`,u=o!=="column__empty",i="",d="";u?(i=`<a class="sortable" data-heading="${p.htmlEncode(a)}" href="#">${p.htmlEncode(c)}</a>`,d=`<a title="${c}" class="sortable" data-heading="${p.htmlEncode(a)}" href="#">
                    ${s}<span class="reader">${c}</span></a>`):i=`${p.htmlEncode(c)}`,e.push(`<th class="${o}">`+i+" "+d+"</th>")}return e.join("")}renderTableData(){let t=[],e=this.getHeadingIndex("ID"),s=this.results.slice(this.resultsOffset,this.resultsOffset+this.perPage);for(let a=0;a<s.length;a++){let o=s[a],c=this.headings.reduce((d,l,r)=>({...d,[l]:o[r]}),{}),u=[],i=[];if(this.rowRenderer){let d=this.rowRenderer(o,this.headings);"classes"in d&&i.push.apply(i,d.classes)}for(let d=0;d<o.length;d++){let l=[],r=this.headings[d];l.push(this.getColumnClass(r));let n=o[d],h=Number(n),m=!isNaN(h)||n.match(/^\d+\/\d+$/)!==null;m?l.push("numeric"):p.isUrl(n)&&l.push("url");let w=`${n}`,E=Number(n),y=this.cellRenderer&&r in this.cellRenderer?this.cellRenderer[r]:null;if(y){let H=y(n,c,a);w=H.content,l.push(...H.classes)}else m&&!isNaN(E)&&r!==""&&r!=="ID"?w=`${Number(n).toLocaleString()}`:l.indexOf("url")>-1&&(w=`<a class="ulink" data-id="${p.htmlEncode(o[e])}" 
                        href="${p.htmlEncode(n)}">${p.htmlEncode(n)}</a>`);u.push(`<td class="${p.htmlEncode(l.join(" "))}">${w}</td>`)}t.push(`<tr class="${p.htmlEncode(i.join(" "))}">${u.join("")}</tr>`)}return t}renderSection(){this.removeHandlers(),this.resultsSort.primarySort!==null&&this.resultsSort.primaryHeading!==null&&this.sortResults();let t=this.renderTableData();if(t.length===0){this.baseElement.innerHTML=`<section>${this.header}<p>No results found.</p></section>`;return}let e=[],s=this.getPagination(),a={"\u25C0\u25C0":!0,"\u25B6\u25B6":!0};for(let l=0;l<s.length;l++){let r=s[l],n=[];r.label in a?n.push(r.label=="\u25C0\u25C0"?"rewind":"fastforward"):r.offset===this.resultsOffset?n.push("current"):r.extended&&n.push("extended"),e.push(`<button class="${n.join(" ")}" data-offset="${r.offset}">${r.label}</button>`)}let o=this.resultsOffset+1,c=Math.min(this.resultsCount,this.resultsOffset+this.perPage),u=this.isCorePlugin()?"`":"\u229E",i=`<section>
            ${this.header}
            <hgroup>
                <div class="info">
                    <span class="info__dl export">
                        <button class="icon">${u}</button>
                        <ul class="export__ulink">
                            <li><a class="ulink" href="#" data-format="csv">Export CSV</a></li>
                            <li><a class="ulink" href="#" data-format="xlsx">Export Excel</a></li>
                        </ul>
                    </span>
                    <span class="info__results"><span class="info__results__nobr">
                        ${o.toLocaleString()} - ${c.toLocaleString()}</span> 
                        <span class="info__results__nobr">of ${this.resultsCount.toLocaleString()}</span></span>
                </div>
                <nav>${e.join("")}</nav>
            </hgroup>
            <div class="datatable">
                <table>
                    <thead>
                        <tr>
                            ${this.renderTableHeadings(this.headings)}                        
                        </tr>
                    </thead>
                    <tbody>
                        ${t.join("")}
                    </tbody>
                </table>
            </div>`;this.baseElement.innerHTML=i;let d=this.baseElement.querySelectorAll("a.sortable");for(let l=0;l<d.length;l++){let r=d[l];if(r.classList.remove("ascending","descending"),r.dataset.heading===this.resultsSort.primaryHeading){let n=this.resultsSort.primarySort==L.Ascending?"ascending":"descending";r.classList.add(n)}}this.addHandlers()}addHandlers(){this.applyHandlers(!0)}removeHandlers(){this.applyHandlers(!1)}isCorePlugin(){let t=window.self!==window.top,e=!1;if(t)try{e=!!window.parent.location.href}catch{e=!1}return t&&e}applyHandlers(t){let e=t?"addEventListener":"removeEventListener",s=this.baseElement.querySelectorAll("nav button");for(let n=0;n<s.length;n++)s[n][e]("click",this.navHandler);let a=this.baseElement.querySelectorAll(".info__dl .ulink");for(let n=0;n<a.length;n++)a[n][e]("click",this.downloadHandler);let o=this.baseElement.querySelector(".info__dl button");if(o!==null&&(o[e]("click",this.downloadMenuHandler),matchMedia("(pointer:fine)").matches&&!/android/i.test(window.navigator.userAgent))){let h=this.baseElement.querySelector(".info__dl");h==null||h.classList.add("hasmouse")}this.baseElement.querySelector("thead")&&(window[e]("message",this.scrollHandler),window[e]("resize",this.scrollHandler));let u=this.baseElement.querySelector("table");if(u){let n=document.querySelector(".wrap");u[e]("touchstart",h=>{n==null||n.classList.add("dragging"),h.stopPropagation()},{passive:!0}),u[e]("touchend",h=>{n==null||n.classList.remove("dragging"),h.stopPropagation()},{passive:!0}),u[e]("touchmove",h=>{h.stopPropagation()},{passive:!0})}let i=this.baseElement.querySelectorAll("button.custom");if(this.cellHandler)for(let n of i)n[e]("click",this.cellHandler);let d=this.baseElement.querySelectorAll("td.url a");for(let n=0;n<d.length;n++)d[n][e]("click",this.browserLinkHandler);for(let n=0;n<s.length;n++)s[n][e]("click",this.navHandler);let l=this.baseElement.querySelectorAll("td.column__id a");for(let n=0;n<l.length;n++)l[n][e]("click",this.appLinkHandler);let r=this.baseElement.querySelectorAll("th a.sortable");for(let n=0;n<r.length;n++)r[n][e]("click",this.sortableHandler)}getPagination(){let t=[],e=0,s=this.paginationEdgeRangeDesktop,a=this.paginationEdgeRangeMobile,o=Math.ceil(this.resultsOffset/this.perPage),c=Math.max(s-o,0),u=Math.max(a-o,0);s+=Math.max(c,0),a+=Math.max(u,0);let i=this.resultsOffset;for(;i>0&&e<s;){i-=this.perPage;let m=`${i/this.perPage+1}`,w=new $(m,i,this.perPage,e>=a);t.push(w),e++}if(this.resultsOffset>0&&(t.push(new $("\u25C0",this.resultsOffset-this.perPage,this.perPage,!1)),t.push(new $("\u25C0\u25C0",0,this.perPage,!1))),t.reverse(),this.resultsCount>this.perPage){let m=`${this.resultsOffset/this.perPage+1}`,w=new $(m,this.resultsOffset,this.perPage,!1);t.push(w)}let d=this.paginationEdgeRangeDesktop,l=this.paginationEdgeRangeMobile,r=Math.ceil(this.resultsOffset/this.perPage),n=Math.max(d-r,0),h=Math.max(l-r,0);for(d+=Math.max(n,0),l+=Math.max(h,0),e=0,i=this.resultsOffset+this.perPage;i<this.resultsCount&&e<d;){let m=`${i/this.perPage+1}`,w=new $(m,i,this.perPage,e>=l);t.push(w),i+=this.perPage,e++}if(this.resultsCount>this.resultsOffset+this.perPage){t.push(new $("\u25B6",this.resultsOffset+this.perPage,this.perPage,!1));let m=this.resultsCount-this.resultsCount%this.perPage;m=m==this.resultsCount?m-this.perPage:m,t.push(new $("\u25B6\u25B6",m,this.perPage,!1))}return t}};var D=class{static standardHeading(t,e){return`<div class="main__heading">
            <div class="main__heading__icon">
                <img id="projectIcon" src="${t.getImageDataUri()}" alt="Icon for @crawlView.DisplayTitle" />
            </div>
            <div class="main__heading__title">
                <h1><span>${p.htmlEncode(e)}</span></h1>
                <div><span>${p.htmlEncode(t.getDisplayTitle())}</span></div>
            </div>
        </div>`}static standardForm(t){return`<div class="main__form">${t}</div>`}static standardResults(){return'<div class="main__results"></div>'}static standardCheckbox(t,e,s,a){return`
        <label>
            <span class="checkbox">
                <input type="checkbox" name="${p.htmlEncode(t)}" value="${p.htmlEncode(e)}"/>
                <span class="checkbox__tick"></span>                                
            </span>
            <span class="checkbox__label">${p.htmlEncode(s)}</span> 
            ${a?'<span class="checkbox__synopsis">'+p.htmlEncode(a)+"</span>":""}
        </label>`}static standardRadio(t,e,s,a){return`        
        <label>
            <span class="radio">
                <input type="radio" name="${p.htmlEncode(t)}" value="${p.htmlEncode(e)}">
                <span class="radio__tick"></span>
            </span>
            <span class="radio__text">${p.htmlEncode(s)}</span>
            ${a?'<span class="radio__synopsis">'+p.htmlEncode(a)+"</span>":""}
        </label>`}static cellRendererSameAsLast(t,e,s){var a;if(!("ID"in e))throw"ID must be present to use cellHandlerSameAsLast";let o=Object.keys(e),u=Object.values(e).indexOf(t),i=o[u],d=e.ID.toString(),l=(a=D.cellHandlerSameAsLastMemo[i])!==null&&a!==void 0?a:"",r=[];return s>0&&l===d&&r.push("sameaslast"),D.cellHandlerSameAsLastMemo[i]=d,{classes:r,content:`${p.htmlEncode(t)}`}}static cellRendererSameAsLastLink(t,e,s){let a=D.cellRendererSameAsLast(t,e,s);return a.content=`<a class= "ulink" 
            data-id="${p.htmlEncode(e.ID)}" 
            href="${p.htmlEncode(t)}">${p.htmlEncode(t)}</a>`,a}static cellRendererLinkedId(t,e,s){let a=new URLSearchParams(window.location.search),o=Object.fromEntries(a.entries()),c=o.origin,u=o.project;if(!c||!u)throw"missing required url arguments";let i=`${c}/search/${u}/resource/${t}/`;return{classes:[],content:`<a class= "ulink" href="${i}"
                data-id="${p.htmlEncode(e.ID)}" 
                href="${p.htmlEncode(i)}">${p.htmlEncode(t)}</a>`}}static cellRendererWrappedContent(t,e,s){return{classes:["wrap"],content:`${p.htmlEncode(t)}`}}};D.cellHandlerSameAsLastMemo={};var B;(function(g){g.Project=k,g.SearchQueryType=C,g.SearchQuery=v,g.Search=b,g.SearchResult=x,g.PluginData=T,g.HtmlUtils=p,g.Plugin=f})(B||(B={}));var U;(function(g){g.HtmlProcessingWidget=A,g.HtmlResultsTable=P,g.Templates=D})(U||(U={}));window.InterroBot={Core:B,Ui:U};})();
