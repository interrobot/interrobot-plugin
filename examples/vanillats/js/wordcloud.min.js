(()=>{var f=class{static getDocument(e){e=e.replace(f.styleAttributeRegex,"");try{return new DOMParser().parseFromString(e,"text/html")}catch(t){console.warn(t)}}static getDocumentCleanText(e){let t=this.getDocument(e);t===null&&(t=new Document);let s=t.querySelectorAll("script, style, svg, noscript, iframe");for(let n=s.length-1;n>=0;n--)s[n].parentElement.removeChild(s[n]);return t}static getDocumentCleanTextIterator(e){let t=f.getDocumentCleanText(e),s="//text() | //meta[@name='description']/@content | //@alt";return t.evaluate(s,t,null,XPathResult.ANY_TYPE,null)}static getElementTextIterator(e,t){let s=".//text()";return e.evaluate(s,t,null,XPathResult.ANY_TYPE,null)}static getElementTextOnly(e,t){let s=f.getElementTextIterator(e,t),n=[],a=s.iterateNext();for(;a;)n.push(a.nodeValue.trim()),a=s.iterateNext();return n.join(" ")}static isUrl(e){return URL.canParse(e)}static htmlEncode(e){return new Option(e).innerHTML}};f.urlsRegex=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-_\:]*)?\??(?:[\-\+=&;%@\.\w_]*)#?(?:[\.\!\/\\\w]*))?)/g;f.urlRegex=/^((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-_\:]*)?\??(?:[\-\+=&;%@\.\w_]*)#?(?:[\.\!\/\\\w]*))?)$/;f.styleAttributeRegex=/style\s*=\s*("([^"]*)"|'([^']*)')/gi;var q;(function(v){v[v.Page=0]="Page",v[v.Asset=1]="Asset",v[v.Any=2]="Any"})(q||(q={}));var te;(function(v){v[v.Id=0]="Id",v[v.Time=1]="Time",v[v.Status=2]="Status",v[v.Url=3]="Url"})(te||(te={}));var se;(function(v){v[v.Ascending=0]="Ascending",v[v.Descending=1]="Descending"})(se||(se={}));var B=class{constructor(e,t,s,n){if(this.meta=t,this.defaultData=s,this.autoformInputs=n,this.project=e,this.data={apiVersion:"1.1",autoform:{}},this.data.autoform===null&&(this.data.autoform=[]),this.data.autoform[this.project]={},n.length>0){let a=async i=>{let l=i.getAttribute("name"),c;i instanceof HTMLSelectElement||i instanceof HTMLTextAreaElement||i.hasAttribute("value")?c=i.value:c=!(i.checked===void 0||i.checked===!1),await this.setAutoformField(l,c)},r=async i=>{let l=i.getAttribute("name"),c=i,u=document.querySelectorAll(`input[type=radio][name=${c.name}]:checked`);if(u.length!==1){console.error("radio control failure");return}let o=u[0].value;await this.setAutoformField(l,o)},d=async i=>{let l=i.getAttribute("name"),c=i,u=document.querySelectorAll(`input[type=checkbox][name=${c.name}]:checked`),o=[];for(let m=0;m<u.length;m++)o.push(u[m].value);let h=o.join("|");await this.setAutoformField(l,h)};for(let i of this.autoformInputs){if(i===null)continue;switch(i.tagName.toLowerCase()){case"input":let c=i;if(c.type=="checkbox"){let h=i,m=document.querySelectorAll(`input[type=checkbox][name=${h.name}]`);m.length===1?c.addEventListener("change",async g=>{await a(c)}):m.length>1&&c.addEventListener("change",async g=>{await d(c)})}else c.type=="radio"?c.addEventListener("change",async h=>{await r(c)}):c.addEventListener("change",async h=>{await a(c)});break;case"textarea":let u=i;u.addEventListener("change",async h=>{await a(u)}),u.addEventListener("input",async h=>{await a(u)});break;case"select":let o=i;o.addEventListener("change",async h=>{await a(o)});break;default:break}}}}async setDataField(e,t,s){this.data[e]!==t&&(this.data[e]=t),s===!0&&await this.updateData()}async getData(){return this.dataLoaded!==null?this.data:(await this.loadData(),this.data)}async loadData(){var e;let t=window.location.href;t==="about:srcdoc"&&(t=`/reports/${window.parent.document.getElementById("report").dataset.report}/`);let s={pluginUrl:t},n=new Date().getTime(),a=await y.postApiRequest("GetPluginData",s),r=new Date().getTime();try{y.logTiming(`Loaded options: ${JSON.stringify(s)}`,r-n);let i=a.data,l=Object.keys(i).length===0,c={};for(let u in this.defaultData){let o=this.defaultData[u];c[u]=this.defaultData[u]}for(let u in i){let o=this.defaultData[u];c[u]=i[u]}l&&(this.data=c,await this.updateData()),this.data=c,this.dataLoaded=new Date}catch{console.warn(`failed to load plugin data @ 
${JSON.stringify(s)}`)}if(this.autoformInputs.length>0){let i={};if(!("autoform"in this.data))this.data.autoform={};else for(let l in this.data.autoform)isNaN(parseInt(l,10))&&delete this.data.autoform[l];this.project in this.data.autoform||(this.data.autoform[this.project]=i)}let d=[];for(let i of this.autoformInputs){if(i===null)continue;let l=i.name,c=(e=this.data.autoform[this.project][l])!==null&&e!==void 0?e:null,u=i.tagName.toLowerCase(),o,h=!1,m=!1,g=!1,w=!1,b=!1;switch(u){case"input":o=i,o.type==="radio"?(g=!0,d.push(l)):o.type==="checkbox"&&typeof c=="boolean"?h=!0:o.type==="checkbox"&&typeof c=="string"&&(m=!0);break;case"textarea":o=i,b=!0;break;case"select":o=i,w=!0;break;default:break}if(!o){console.warn("autoform: no input found");return}switch(!0){case g:o.checked=c===o.value;break;case h:o.checked=c||!1;break;case m:o.checked=c?c.toString().indexOf(o.value)>=0:!1;break;case b:o.value=c||"";break;case w:default:c&&(o.value=c);break}}d.forEach(i=>{if(!(document.querySelector(`input[name=${i}]:checked`)!==null)){let c=document.querySelector(`input[name=${i}]`);c&&(c.checked=!0)}})}async setAutoformField(e,t){var s,n;let r=(s=(await this.getData()).autoform)!==null&&s!==void 0?s:{},d=(n=r[this.project])!==null&&n!==void 0?n:{};d[e]!==t&&(d[e]=t,await this.setDataField("autoform",r,!0))}async updateData(){let e=await this.getData();e.meta=this.meta;let t={pluginUrl:window.location.href,pluginData:e},s=await y.postApiRequest("SetPluginData",t)}getDataSlug(){let e=this.getPluginUrl();return btoa(e)}getPluginUrl(){return`${window.location.protocol}//${window.location.host}${window.location.pathname}`}},S=class{constructor({project:e,query:t,fields:s,type:n,includeExternal:a,includeNoRobots:r,sort:d,perPage:i}){this.includeExternal=!0,this.includeNoRobots=!1,this.project=e,this.query=t,this.fields=s,this.type=n,this.includeExternal=a!=null?a:!0,this.includeNoRobots=r!=null?r:!1,this.perPage=i!=null?i:S.maxPerPage,S.validSorts.indexOf(d)>=0?this.sort=d:this.sort=S.validSorts[1]}getHaystackCacheKey(){return`${this.project}~${this.fields}~${this.type}~${this.includeExternal}~${this.includeNoRobots}`}};S.maxPerPage=100;S.validSorts=["?","id","-id","time","-time","status","-status","url","-url"];var M=class{static async execute(e,t,s,n=!1,a=!0,r="Processing..."){let d=new Date().getTime();if(e.getHaystackCacheKey()===M.resultsHaystackCacheKey&&t){let o=t.size;if(a===!1){let m=new CustomEvent("ProcessingMessage",{detail:{action:"set",message:r}});document.dispatchEvent(m)}await M.sleep(16);let h=0;if(await t.forEach(async(m,g)=>{await s(m)}),y.logTiming(`Processed ${o.toLocaleString()} search result(s)`,new Date().getTime()-d),a===!1){let m={detail:{action:"clear"}},g=new CustomEvent("ProcessingMessage",m);document.dispatchEvent(g)}return!0}else M.resultsHaystackCacheKey=e.getHaystackCacheKey(),M.resultsCacheTotal=0;let i={project:e.project,query:e.query,external:e.includeExternal,type:q[e.type].toLowerCase(),offset:0,fields:e.fields.split("|"),norobots:e.includeNoRobots,sort:e.sort,perpage:e.perPage},l=await y.postApiRequest("GetResources",i),c=l.__meta__.results.total;M.resultsCacheTotal=c;let u=l.results;for(let o=0;o<u.length;o++){let h=u[o];await M.handleResult(h,c,s)}for(;l.__meta__.results.pagination.nextOffset!==null&&n===!0;){let o=l.__meta__.results.pagination.nextOffset;i.offset=o,l=await y.postApiRequest("GetResources",i),u=l.results;for(let h=0;h<u.length;h++){let m=u[h];await M.handleResult(m,c,s)}}return y.logTiming(`Loaded/processed ${c.toLocaleString()} search result(s)`,new Date().getTime()-d),!1}static async sleep(e){return new Promise(t=>setTimeout(()=>t(),e))}static async handleResult(e,t,s){let n=new A(e);await s(n);let a=n.result,r=new CustomEvent("SearchResultHandled",{detail:{resultNum:a,resultTotal:t}});document.dispatchEvent(r)}},A=class{static normalizeContentWords(e){let t=[];return e!==""&&t.push.apply(t,e.split(/\s+/)),t}static normalizeContentString(e){return A.normalizeContentWords(e).join(" ")}constructor(e){this.optionalFields=["created","modified","size","status","time","norobots","name","type","content","headers","links","assets","origin"],this.result=e.result,this.id=e.id,this.url=e.url,this.processedContent="";for(let t of this.optionalFields)t in e&&(t==="created"||t==="modified"?this[t]=new Date(e[t]):this[t]=e[t])}hasProcessedContent(){return this.processedContent!=""}getProcessedContent(){return this.processedContent}setProcessedContent(e){this.processedContent=e}getContent(){return this.content}getContentTextOnly(){let e=[],t=null,s=f.getDocumentCleanTextIterator(this.getContent());for(t=s.iterateNext();t!==null;){let a=A.normalizeContentString(t.nodeValue);if(a!==""){let r=a.split(" ").filter(d=>d!=="");r.length>0&&e.push.apply(e,r)}t=s.iterateNext()}let n=e.join(" ");return n=n.replace(A.wordPunctuationRe,""),n=n.replace(A.wordWhitespaceRe," "),n}getHeaders(){return this.headers}getUrlPath(){return new URL(this.url).pathname}clearFulltextFields(){this.content="",this.headers=""}};A.wordPunctuationRe=/\s+(?=[\.,;:!\?] )/g;A.wordWhitespaceRe=/\s+/g;var Z=class{constructor(e,t,s,n,a,r,d){this.id=-1,this.created=null,this.modified=null,this.project=-1,this.time=-1,this.report=null,this.id=e,this.created=s,this.modified=n,this.complete=a,this.project=t,this.time=r,this.report=d}getTimings(){return this.getReportDetailByKey("timings")}getSizes(){return this.getReportDetailByKey("sizes")}getCounts(){return this.getReportDetailByKey("counts")}getReportDetailByKey(e){return this.report&&this.report.hasOwnProperty("detail")&&this.report.detail.hasOwnProperty(e)?this.report.detail[e]:null}},O=class{constructor(e,t,s,n,a){this.id=-1,this.created=null,this.modified=null,this.id=e,this.created=t,this.modified=s,this.url=n,this.imageDataUri=a}getImageDataUri(){return this.imageDataUri}getDisplayTitle(){return new URL(this.url).hostname}static async getApiProject(e){let t={projects:[e],fields:["image","created","modified"]},n=(await y.postApiRequest("GetProjects",t)).results;for(let a=0;a<n.length;a++){let r=n[a];if(r.id===e){let d=new Date(r.created),i=new Date(r.modified),l=r.url,c=r.image;return new O(e,d,i,l,c)}}return null}static async getApiCrawls(e){let t={complete:"complete",project:e,fields:["created","modified","report","time"]},s=await y.postApiRequest("GetCrawls",t),n=[],a=s.results;for(let r=0;r<a.length;r++){let d=a[r],i=new Z(d.id,e,new Date(d.created),new Date(d.modified),d.complete,d.time,d.report);n.push(i)}return n}};var V=class{constructor(){let e=document.body;e.addEventListener("touchstart",t=>{this.proxyToContainer(t)},{passive:!0}),e.addEventListener("touchend",t=>{this.proxyToContainer(t)},{passive:!0}),e.addEventListener("touchmove",t=>{this.proxyToContainer(t)},{passive:!0})}async proxyToContainer(e){var t;let s,n=(t=e.touches)!==null&&t!==void 0?t:e.changedTouches;if(e.touches.length===1)s=e.touches[0];else if(e.changedTouches.length===1)s=e.changedTouches[0];else return;let r={target:"interrobot",data:{reportTouch:{identifier:null,target:null,clientX:s.clientX,clientY:s.clientY,pageX:s.pageX,pageY:s.pageY,screenX:s.screenX,screenY:s.screenY,radiusX:s.radiusX,radiusY:s.radiusY,rotationAngle:s.rotationAngle,force:s.force,eventType:e.type}}};window.parent.postMessage(r,"*")}async touchEnd(e){}async touchMove(e){}};var _;(function(v){v[v.Light=0]="Light",v[v.Dark=1]="Dark"})(_||(_={}));var J=class{constructor(e,t){this.iframeSrc=e,t?this.hostOrigin=t:this.hostOrigin="";let s=new URL(e);e==="about:srcdoc"?this.pluginOrigin="about:srcdoc":this.pluginOrigin=s.origin}getIframeSrc(){return this.iframeSrc}getHostOrigin(){return this.hostOrigin}getPluginOrigin(){return this.pluginOrigin}toString(){return`host = ${this.hostOrigin}; plugin = ${this.pluginOrigin}`}},y=class{static async initialize(e){let t=()=>{let s=new e;return y.postMeta(s.constructor.meta),window.addEventListener("load",()=>y.postContentHeight()),window.addEventListener("resize",()=>y.postContentHeight()),s};return document.readyState==="complete"||document.readyState==="interactive"?t():new Promise(s=>{document.addEventListener("DOMContentLoaded",()=>{s(t())})})}static postContentHeight(e=null){let t=document.querySelector(".main__results"),s=document.body.scrollHeight;if(t&&(s=Number(t.getBoundingClientRect().bottom)),s!==y.contentScrollHeight){let a={target:"interrobot",data:{reportHeight:e&&e>=1?Math.min(e,s):s}};y.routeMessage(a)}}static postOpenResourceLink(e,t){let s={target:"interrobot",data:{reportLink:{openInBrowser:t,resource:e}}};y.routeMessage(s)}static postMeta(e){let t={target:"interrobot",data:{reportMeta:e}};y.routeMessage(t)}static async postApiRequest(e,t){let s=null;return await(async()=>new Promise(a=>{let r=async i=>{var l;if(i===void 0)return;let c=i.data,u=(l=c.data)!==null&&l!==void 0?l:{};if(u&&typeof u=="object"&&u.hasOwnProperty("apiResponse")){let o=u.apiResponse.__meta__.request.method;e===o&&(s=c.data.apiResponse,window.removeEventListener("message",r),a())}},d={target:"interrobot",data:{apiRequest:{method:e,kwargs:t}}};window.addEventListener("message",r),y.routeMessage(d)}))(),s}static logTiming(e,t){let s=(t/1e3).toFixed(3);console.log(`\u{1F916} [${s}s] ${e}`)}static routeMessage(e){let t="";y.connection?(t=y.connection.getHostOrigin(),window.parent.postMessage(e,t)):window.parent.postMessage(e)}constructor(){this.projectId=-1,this.mode=_.Light;let e,t,s;if(this.parentIsOrigin()){let r=window.parent.document.getElementById("report");e=parseInt(r.dataset.project,10),t=parseInt(r.dataset.mode,10),s=r.dataset.origin}else{let r=new URLSearchParams(window.location.search);e=parseInt(r.get("project"),10),t=parseInt(r.get("mode"),10),s=r.get("origin")}if(y.connection=new J(document.location.href,s),isNaN(e)){let r="missing project url argument";throw new Error(r)}this.data=null,this.projectId=e,this.mode=isNaN(t)||t!==1?_.Light:_.Dark,y.contentScrollHeight=0;let n=_[this.mode].toLowerCase();document.body.classList.remove("light","dark"),document.body.classList.add(n);let a=new V}delay(e){return new Promise(t=>setTimeout(t,e))}getMode(){return this.mode}getProjectId(){return this.projectId}getInstanceMeta(){return this.constructor.meta}async initData(e,t){this.data=new B(this.getProjectId(),this.getInstanceMeta(),e,t),await this.data.loadData()}async initAndGetData(e,t){return await this.initData(e,t),this.data}async getProject(){if(this.project===void 0){let e=await O.getApiProject(this.projectId);if(e===null){let t=`project id=${this.projectId} not found`;throw new Error(t)}this.project=e}return this.project}render(e){document.body.innerHTML=e}async index(){let e=await O.getApiProject(this.getProjectId()),t=f.htmlEncode(e.getDisplayTitle()),s=f.htmlEncode(y.meta.title);this.render(`
            <div class="main__heading">
                <div class="main__heading__icon">
                    <img id="projectIcon" src="${e.getImageDataUri()}" alt="Icon for ${t}" />
                </div>
                <div class="main__heading__title">
                    <h1>${s}</h1>
                    <div><span>${t}</span></div>
                </div>
            </div>
            <div class="main__form">
                <p>Welcome, from the index() of the Plugin base-class. This page exists as a placeholder, 
                but in your hands it could be so much more. The Example Report form below will count and 
                present page title terms used across the website, by count.
                It's an example to help get you started.</p>
                <p>If you have any questions, please reach out to the dev via the in-app contact form.</p>
                <form><button>Example Report</button></form>
            </div>
            <div class="main__results"></div>`),document.getElementsByTagName("button")[0].addEventListener("click",async a=>{await this.process()})}async process(){let e=new Map,t,s=async(i,l)=>{let c=i.name.trim().split(/[\s\-â€”]+/g);for(let u of c)if(!l.has(u))l.set(u,1);else{let o=l.get(u);l.set(u,o+1)}},n=this.getProjectId(),a="headers: text/html",r="name",d=new S({project:n,query:a,fields:r,type:q.Any,includeExternal:!1,includeNoRobots:!1});await M.execute(d,t,async i=>{await s(i,e)},!0,!1,"Processing\u2026"),await this.report(e)}async report(e){let t=new Map([...e.entries()].sort((a,r)=>{let d=a[1],i=r[1];return d===i?a[0].toLowerCase().localeCompare(r[0].toLowerCase()):i-d})),s=[];for(let a of t.keys()){let r=t.get(a),d=a.length>24?a.substring(24)+"\u2026":a;s.push(`<tr><td>${f.htmlEncode(d)}</td><td>${r.toLocaleString()}</td></tr>`)}let n=document.querySelector(".main__results");n.innerHTML=s.length===0?"<p>No results found.</p>":`<div><section><table style="max-width:340px">
            <thead><tr><th>Term</th><th>Count</th></tr></thead>
            <tbody>${s.join("")}</tbody>
            </table></section></div>`,y.postContentHeight()}parentIsOrigin(){try{if(!window.parent||window.parent===window)return!1;let e=window.parent.document;return e?!e.hidden:!1}catch{return!1}}};y.meta={title:"InterroBot Base Plugin",category:"Example",version:"1.0",author:"InterroBot",description:`Welcome to InterroBot plugin development. This base-class Plugin can already 
        query the database, draw conclusions, and report back. It's just few tweaks away from being 
        your own creation.

This is the default plugin description. Set meta: {} values
        in the source to update these display values.`};var F=class{static createElement(e,t){let s=new F(t),n=s.getBaseElement();return e&&n?e.appendChild(n):console.warn(`unable to create processing widget: parent [${e}], base [${n}]`),s}constructor(e){this.prefix=e,this.total=0,this.loaded=0,this.active=!0,this.baseElement=document.createElement("div"),this.baseElement.id="processingWidget",this.baseElement.classList.add("processing","hidden"),this.baseElement.innerHTML="",document.addEventListener("SearchResultHandled",async t=>{if(this.active===!1)return;let s=t.detail.resultTotal,n=t.detail.resultNum,a=Math.ceil(n/s*100),r=Math.ceil(this.loaded/this.total*100);if(a>100||r===100){this.baseElement.classList.remove("throbbing");return}this.total=s,this.loaded=n,this.baseElement.innerHTML=a>100?"":`${this.prefix}
                <span class="resultNum">##</span>/<span class="resultTotal">##</span>
                (<span class="percentTotal">##</span>)`;let d=this.baseElement.querySelector(".resultNum");d&&(d.innerText=`${t.detail.resultNum.toLocaleString()}`);let i=this.baseElement.querySelector(".resultTotal");i&&(i.innerText=`${t.detail.resultTotal.toLocaleString()}`);let l=this.baseElement.querySelector(".percentTotal");l&&(l.innerText=`${a}%`),[0,100].indexOf(a)>=0?this.baseElement.classList.remove("throbbing"):this.baseElement.classList.add("throbbing")}),document.addEventListener("ProcessingMessage",async t=>{if(this.active===!1)return;switch(t.detail.action){case"set":this.baseElement.innerHTML="",this.baseElement.innerText=t.detail.message,this.baseElement.classList.add("throbbing");break;case"clear":default:this.baseElement.classList.remove("throbbing");break}})}clearMessage(){this.baseElement.classList.remove("throbbing")}getBaseElement(){return this.baseElement}setPrefix(e){this.prefix=e}setMessage(e){this.baseElement.innerHTML=`${e}`,this.baseElement.classList.add("throbbing")}setActive(e){this.active=e}};var H=class{static standardHeading(e,t){return`<div class="main__heading">
            <div class="main__heading__icon">
                <img id="projectIcon" src="${e.getImageDataUri()}" alt="Icon for @crawlView.DisplayTitle" />
            </div>
            <div class="main__heading__title">
                <h1><span>${f.htmlEncode(t)}</span></h1>
                <div><span>${f.htmlEncode(e.getDisplayTitle())}</span></div>
            </div>
        </div>`}static standardForm(e){return`<div class="main__form">${e}</div>`}static standardResults(){return'<div class="main__results"></div>'}static standardCheckbox(e,t,s,n){return`
        <label>
            <span class="checkbox">
                <input type="checkbox" name="${f.htmlEncode(e)}" value="${f.htmlEncode(t)}"/>
                <span class="checkbox__tick"></span>                                
            </span>
            <span class="checkbox__label">${f.htmlEncode(s)}</span> 
            ${n?'<span class="checkbox__synopsis">'+f.htmlEncode(n)+"</span>":""}
        </label>`}static standardRadio(e,t,s,n){return`        
        <label>
            <span class="radio">
                <input type="radio" name="${f.htmlEncode(e)}" value="${f.htmlEncode(t)}">
                <span class="radio__tick"></span>
            </span>
            <span class="radio__text">${f.htmlEncode(s)}</span>
            ${n?'<span class="radio__synopsis">'+f.htmlEncode(n)+"</span>":""}
        </label>`}static cellRendererSameAsLast(e,t,s){var n;if(!("ID"in t))throw"ID must be present to use cellHandlerSameAsLast";let a=Object.keys(t),d=Object.values(t).indexOf(e),i=a[d],l=t.ID.toString(),c=(n=H.cellHandlerSameAsLastMemo[i])!==null&&n!==void 0?n:"",u=[];return s>0&&c===l&&u.push("sameaslast"),H.cellHandlerSameAsLastMemo[i]=l,{classes:u,content:`${f.htmlEncode(e)}`}}static cellRendererSameAsLastLink(e,t,s){let n=H.cellRendererSameAsLast(e,t,s);return n.content=`<a class= "ulink" 
            data-id="${f.htmlEncode(t.ID)}" 
            href="${f.htmlEncode(e)}">${f.htmlEncode(e)}</a>`,n}static cellRendererLinkedId(e,t,s){let n=new URLSearchParams(window.location.search),a=Object.fromEntries(n.entries()),r=a.origin,d=a.project;if(!r||!d)throw"missing required url arguments";let i=`${r}/search/${d}/resource/${e}/`;return{classes:[],content:`<a class= "ulink" href="${i}"
                data-id="${f.htmlEncode(t.ID)}" 
                href="${f.htmlEncode(i)}">${f.htmlEncode(e)}</a>`}}static cellRendererWrappedContent(e,t,s){return{classes:["wrap"],content:`${f.htmlEncode(e)}`}}};H.cellHandlerSameAsLastMemo={};var X=class{static getStopwordsTruth(e){return this.getStopwords(e).reduce((s,n,a)=>({...s,[n]:!0}),{})}static getStopwords(e){switch(e){case"de":return["aber","alle","allem","allen","aller","alles","als","also","am","an","ander","andere","anderem","anderen","anderer","anderes","anderm","andern","anderr","anders","auch","auf","aus","bei","bin","bis","bist","da","damit","dann","der","den","des","dem","die","das","dass","da\xDF","derselbe","derselben","denselben","desselben","demselben","dieselbe","dieselben","dasselbe","dazu","dein","deine","deinem","deinen","deiner","deines","denn","derer","dessen","dich","dir","du","dies","diese","diesem","diesen","dieser","dieses","doch","dort","durch","ein","eine","einem","einen","einer","eines","einig","einige","einigem","einigen","einiger","einiges","einmal","er","ihn","ihm","es","etwas","euer","eure","eurem","euren","eurer","eures","f\xFCr","gegen","gewesen","hab","habe","haben","hat","hatte","hatten","hier","hin","hinter","ich","mich","mir","ihr","ihre","ihrem","ihren","ihrer","ihres","euch","im","in","indem","ins","ist","jede","jedem","jeden","jeder","jedes","jene","jenem","jenen","jener","jenes","jetzt","kann","kein","keine","keinem","keinen","keiner","keines","k\xF6nnen","k\xF6nnte","machen","man","manche","manchem","manchen","mancher","manches","mein","meine","meinem","meinen","meiner","meines","mit","muss","musste","nach","nicht","nichts","noch","nun","nur","ob","oder","ohne","sehr","sein","seine","seinem","seinen","seiner","seines","selbst","sich","sie","ihnen","sind","so","solche","solchem","solchen","solcher","solches","soll","sollte","sondern","sonst","\xFCber","um","und","uns","unsere","unserem","unseren","unser","unseres","unter","viel","vom","von","vor","w\xE4hrend","war","waren","warst","was","weg","weil","weiter","welche","welchem","welchen","welcher","welches","wenn","werde","werden","wie","wieder","will","wir","wird","wirst","wo","wollen","wollte","w\xFCrde","w\xFCrden","zu","zum","zur","zwar","zwischen"];case"en":return["i","me","my","myself","we","our","ours","ourselves","you","you're","you've","you'll","you'd","your","yours","yourself","yourselves","he","him","his","himself","she","she's","her","hers","herself","it","it's","its","itself","they","them","their","theirs","themselves","what","which","who","whom","this","that","that'll","these","those","am","is","are","was","were","be","been","being","have","has","had","having","do","does","did","doing","a","an","the","and","but","if","or","because","as","until","while","of","at","by","for","with","about","against","between","into","through","during","before","after","above","below","to","from","up","down","in","out","on","off","over","under","again","further","then","once","here","there","when","where","why","how","all","any","both","each","few","more","most","other","some","such","no","nor","not","only","own","same","so","than","too","very","s","t","can","will","just","don","don't","should","should've","now","d","ll","m","o","re","ve","y","ain","aren","aren't","couldn","couldn't","didn","didn't","doesn","doesn't","hadn","hadn't","hasn","hasn't","haven","haven't","isn","isn't","ma","mightn","mightn't","mustn","mustn't","needn","needn't","shan","shan't","shouldn","shouldn't","wasn","wasn't","weren","weren't","won","won't","wouldn","wouldn't"];case"fr":return["au","aux","avec","ce","ces","dans","de","des","du","elle","en","et","eux","il","ils","je","la","le","les","leur","lui","ma","mais","me","m\xEAme","mes","moi","mon","ne","nos","notre","nous","on","ou","par","pas","pour","qu","que","qui","sa","se","ses","son","sur","ta","te","tes","toi","ton","tu","un","une","vos","votre","vous","c","d","j","l","\xE0","m","n","s","t","y","\xE9t\xE9","\xE9t\xE9e","\xE9t\xE9es","\xE9t\xE9s","\xE9tant","\xE9tante","\xE9tants","\xE9tantes","suis","es","est","sommes","\xEAtes","sont","serai","seras","sera","serons","serez","seront","serais","serait","serions","seriez","seraient","\xE9tais","\xE9tait","\xE9tions","\xE9tiez","\xE9taient","fus","fut","f\xFBmes","f\xFBtes","furent","sois","soit","soyons","soyez","soient","fusse","fusses","f\xFBt","fussions","fussiez","fussent","ayant","ayante","ayantes","ayants","eu","eue","eues","eus","ai","as","avons","avez","ont","aurai","auras","aura","aurons","aurez","auront","aurais","aurait","aurions","auriez","auraient","avais","avait","avions","aviez","avaient","eut","e\xFBmes","e\xFBtes","eurent","aie","aies","ait","ayons","ayez","aient","eusse","eusses","e\xFBt","eussions","eussiez","eussent"];case"pt":return["a","\xE0","ao","aos","aquela","aquelas","aquele","aqueles","aquilo","as","\xE0s","at\xE9","com","como","da","das","de","dela","delas","dele","deles","depois","do","dos","e","\xE9","ela","elas","ele","eles","em","entre","era","eram","\xE9ramos","essa","essas","esse","esses","esta","est\xE1","estamos","est\xE3o","estar","estas","estava","estavam","est\xE1vamos","este","esteja","estejam","estejamos","estes","esteve","estive","estivemos","estiver","estivera","estiveram","estiv\xE9ramos","estiverem","estivermos","estivesse","estivessem","estiv\xE9ssemos","estou","eu","foi","fomos","for","fora","foram","f\xF4ramos","forem","formos","fosse","fossem","f\xF4ssemos","fui","h\xE1","haja","hajam","hajamos","h\xE3o","havemos","haver","hei","houve","houvemos","houver","houvera","houver\xE1","houveram","houv\xE9ramos","houver\xE3o","houverei","houverem","houveremos","houveria","houveriam","houver\xEDamos","houvermos","houvesse","houvessem","houv\xE9ssemos","isso","isto","j\xE1","lhe","lhes","mais","mas","me","mesmo","meu","meus","minha","minhas","muito","na","n\xE3o","nas","nem","no","nos","n\xF3s","nossa","nossas","nosso","nossos","num","numa","o","os","ou","para","pela","pelas","pelo","pelos","por","qual","quando","que","quem","s\xE3o","se","seja","sejam","sejamos","sem","ser","ser\xE1","ser\xE3o","serei","seremos","seria","seriam","ser\xEDamos","seu","seus","s\xF3","somos","sou","sua","suas","tamb\xE9m","te","tem","t\xE9m","temos","tenha","tenham","tenhamos","tenho","ter\xE1","ter\xE3o","terei","teremos","teria","teriam","ter\xEDamos","teu","teus","teve","tinha","tinham","t\xEDnhamos","tive","tivemos","tiver","tivera","tiveram","tiv\xE9ramos","tiverem","tivermos","tivesse","tivessem","tiv\xE9ssemos","tu","tua","tuas","um","uma","voc\xEA","voc\xEAs","vos"];case"ru":return["\u0438","\u0432","\u0432\u043E","\u043D\u0435","\u0447\u0442\u043E","\u043E\u043D","\u043D\u0430","\u044F","\u0441","\u0441\u043E","\u043A\u0430\u043A","\u0430","\u0442\u043E","\u0432\u0441\u0435","\u043E\u043D\u0430","\u0442\u0430\u043A","\u0435\u0433\u043E","\u043D\u043E","\u0434\u0430","\u0442\u044B","\u043A","\u0443","\u0436\u0435","\u0432\u044B","\u0437\u0430","\u0431\u044B","\u043F\u043E","\u0442\u043E\u043B\u044C\u043A\u043E","\u0435\u0435","\u043C\u043D\u0435","\u0431\u044B\u043B\u043E","\u0432\u043E\u0442","\u043E\u0442","\u043C\u0435\u043D\u044F","\u0435\u0449\u0435","\u043D\u0435\u0442","\u043E","\u0438\u0437","\u0435\u043C\u0443","\u0442\u0435\u043F\u0435\u0440\u044C","\u043A\u043E\u0433\u0434\u0430","\u0434\u0430\u0436\u0435","\u043D\u0443","\u0432\u0434\u0440\u0443\u0433","\u043B\u0438","\u0435\u0441\u043B\u0438","\u0443\u0436\u0435","\u0438\u043B\u0438","\u043D\u0438","\u0431\u044B\u0442\u044C","\u0431\u044B\u043B","\u043D\u0435\u0433\u043E","\u0434\u043E","\u0432\u0430\u0441","\u043D\u0438\u0431\u0443\u0434\u044C","\u043E\u043F\u044F\u0442\u044C","\u0443\u0436","\u0432\u0430\u043C","\u0432\u0435\u0434\u044C","\u0442\u0430\u043C","\u043F\u043E\u0442\u043E\u043C","\u0441\u0435\u0431\u044F","\u043D\u0438\u0447\u0435\u0433\u043E","\u0435\u0439","\u043C\u043E\u0436\u0435\u0442","\u043E\u043D\u0438","\u0442\u0443\u0442","\u0433\u0434\u0435","\u0435\u0441\u0442\u044C","\u043D\u0430\u0434\u043E","\u043D\u0435\u0439","\u0434\u043B\u044F","\u043C\u044B","\u0442\u0435\u0431\u044F","\u0438\u0445","\u0447\u0435\u043C","\u0431\u044B\u043B\u0430","\u0441\u0430\u043C","\u0447\u0442\u043E\u0431","\u0431\u0435\u0437","\u0431\u0443\u0434\u0442\u043E","\u0447\u0435\u0433\u043E","\u0440\u0430\u0437","\u0442\u043E\u0436\u0435","\u0441\u0435\u0431\u0435","\u043F\u043E\u0434","\u0431\u0443\u0434\u0435\u0442","\u0436","\u0442\u043E\u0433\u0434\u0430","\u043A\u0442\u043E","\u044D\u0442\u043E\u0442","\u0442\u043E\u0433\u043E","\u043F\u043E\u0442\u043E\u043C\u0443","\u044D\u0442\u043E\u0433\u043E","\u043A\u0430\u043A\u043E\u0439","\u0441\u043E\u0432\u0441\u0435\u043C","\u043D\u0438\u043C","\u0437\u0434\u0435\u0441\u044C","\u044D\u0442\u043E\u043C","\u043E\u0434\u0438\u043D","\u043F\u043E\u0447\u0442\u0438","\u043C\u043E\u0439","\u0442\u0435\u043C","\u0447\u0442\u043E\u0431\u044B","\u043D\u0435\u0435","\u0441\u0435\u0439\u0447\u0430\u0441","\u0431\u044B\u043B\u0438","\u043A\u0443\u0434\u0430","\u0437\u0430\u0447\u0435\u043C","\u0432\u0441\u0435\u0445","\u043D\u0438\u043A\u043E\u0433\u0434\u0430","\u043C\u043E\u0436\u043D\u043E","\u043F\u0440\u0438","\u043D\u0430\u043A\u043E\u043D\u0435\u0446","\u0434\u0432\u0430","\u043E\u0431","\u0434\u0440\u0443\u0433\u043E\u0439","\u0445\u043E\u0442\u044C","\u043F\u043E\u0441\u043B\u0435","\u043D\u0430\u0434","\u0431\u043E\u043B\u044C\u0448\u0435","\u0442\u043E\u0442","\u0447\u0435\u0440\u0435\u0437","\u044D\u0442\u0438","\u043D\u0430\u0441","\u043F\u0440\u043E","\u0432\u0441\u0435\u0433\u043E","\u043D\u0438\u0445","\u043A\u0430\u043A\u0430\u044F","\u043C\u043D\u043E\u0433\u043E","\u0440\u0430\u0437\u0432\u0435","\u0442\u0440\u0438","\u044D\u0442\u0443","\u043C\u043E\u044F","\u0432\u043F\u0440\u043E\u0447\u0435\u043C","\u0445\u043E\u0440\u043E\u0448\u043E","\u0441\u0432\u043E\u044E","\u044D\u0442\u043E\u0439","\u043F\u0435\u0440\u0435\u0434","\u0438\u043D\u043E\u0433\u0434\u0430","\u043B\u0443\u0447\u0448\u0435","\u0447\u0443\u0442\u044C","\u0442\u043E\u043C","\u043D\u0435\u043B\u044C\u0437\u044F","\u0442\u0430\u043A\u043E\u0439","\u0438\u043C","\u0431\u043E\u043B\u0435\u0435","\u0432\u0441\u0435\u0433\u0434\u0430","\u043A\u043E\u043D\u0435\u0447\u043D\u043E","\u0432\u0441\u044E","\u043C\u0435\u0436\u0434\u0443"];case"sp":return["de","la","que","el","en","y","a","los","del","se","las","por","un","para","con","no","una","su","al","lo","como","m\xE1s","pero","sus","le","ya","o","este","s\xED","porque","esta","entre","cuando","muy","sin","sobre","tambi\xE9n","me","hasta","hay","donde","quien","desde","todo","nos","durante","todos","uno","les","ni","contra","otros","ese","eso","ante","ellos","e","esto","m\xED","antes","algunos","qu\xE9","unos","yo","otro","otras","otra","\xE9l","tanto","esa","estos","mucho","quienes","nada","muchos","cual","poco","ella","estar","estas","algunas","algo","nosotros","mi","mis","t\xFA","te","ti","tu","tus","ellas","nosotras","vosotros","vosotras","os","m\xEDo","m\xEDa","m\xEDos","m\xEDas","tuyo","tuya","tuyos","tuyas","suyo","suya","suyos","suyas","nuestro","nuestra","nuestros","nuestras","vuestro","vuestra","vuestros","vuestras","esos","esas","estoy","est\xE1s","est\xE1","estamos","est\xE1is","est\xE1n","est\xE9","est\xE9s","estemos","est\xE9is","est\xE9n","estar\xE9","estar\xE1s","estar\xE1","estaremos","estar\xE9is","estar\xE1n","estar\xEDa","estar\xEDas","estar\xEDamos","estar\xEDais","estar\xEDan","estaba","estabas","est\xE1bamos","estabais","estaban","estuve","estuviste","estuvo","estuvimos","estuvisteis","estuvieron","estuviera","estuvieras","estuvi\xE9ramos","estuvierais","estuvieran","estuviese","estuvieses","estuvi\xE9semos","estuvieseis","estuviesen","estando","estado","estada","estados","estadas","estad","he","has","ha","hemos","hab\xE9is","han","haya","hayas","hayamos","hay\xE1is","hayan","habr\xE9","habr\xE1s","habr\xE1","habremos","habr\xE9is","habr\xE1n","habr\xEDa","habr\xEDas","habr\xEDamos","habr\xEDais","habr\xEDan","hab\xEDa","hab\xEDas","hab\xEDamos","hab\xEDais","hab\xEDan","hube","hubiste","hubo","hubimos","hubisteis","hubieron","hubiera","hubieras","hubi\xE9ramos","hubierais","hubieran","hubiese","hubieses","hubi\xE9semos","hubieseis","hubiesen","habiendo","habido","habida","habidos","habidas","soy","eres","es","somos","sois","son","sea","seas","seamos","se\xE1is","sean","ser\xE9","ser\xE1s","ser\xE1","seremos","ser\xE9is","ser\xE1n","ser\xEDa","ser\xEDas","ser\xEDamos","ser\xEDais","ser\xEDan","era","eras","\xE9ramos","erais","eran","fui","fuiste","fue","fuimos","fuisteis","fueron","fuera","fueras","fu\xE9ramos","fuerais","fueran","fuese","fueses","fu\xE9semos","fueseis","fuesen","sintiendo","sentido","sentida","sentidos","sentidas","siente","sentid","tengo","tienes","tiene","tenemos","ten\xE9is","tienen","tenga","tengas","tengamos","teng\xE1is","tengan","tendr\xE9","tendr\xE1s","tendr\xE1","tendremos","tendr\xE9is","tendr\xE1n","tendr\xEDa","tendr\xEDas","tendr\xEDamos","tendr\xEDais","tendr\xEDan","ten\xEDa","ten\xEDas","ten\xEDamos","ten\xEDais","ten\xEDan","tuve","tuviste","tuvo","tuvimos","tuvisteis","tuvieron","tuviera","tuvieras","tuvi\xE9ramos","tuvierais","tuvieran","tuviese","tuvieses","tuvi\xE9semos","tuvieseis","tuviesen","teniendo","tenido","tenida","tenidos","tenidas","tened"];case"":return[];default:let t=`Language ${e} not currently supported. Stopwords are disabled.`;return console.warn(t),[]}}};var U=class{static parseCodes(e,t){let s=[];if(!e)s=[];else if(!("FLAG"in t))s=e.split("");else if(t.FLAG==="long"){let r=[];for(var n=0,a=e.length;n<a;n+=2)r.push(e.substring(n,n+2));s=r}else t.FLAG==="num"?s=e.split(","):t.FLAG==="UTF-8"?s=Array.from(e):s=e.split("");return s}constructor(e,t,s,n){this.code=e,this.type=t,this.combinable=s,this.entries=n}applyRule(e,t,s){for(let n=0,a=this.entries.length;n<a;n++){let r=this.entries[n];if(!r.match||r.match.test(e)){let d=e;r.remove&&(d=d.replace(r.remove,"")),this.type==="SFX"?d=d+r.add:d=r.add+d,s.push(d);let i=r.continuationClasses.length;if(i>0)for(let l=0;l<i;l++){let c=r.continuationClasses[l],u=t[c];u&&u.applyRule(d,t,s)}}}}},I=class{constructor(e,t,s,n){this.add=e||null,this.match=this.getMemoRegex(t),this.remove=this.getMemoRegex(s),this.continuationClasses=n||[]}static fromLine(e,t,s){let n=e.split(/\s+/),a=n[2],r=n[3]?n[3].split("/"):[],d=n[4],i=r[0],l=r[1];i==="0"&&(i="");let c=i,u=null;d&&d!=="."&&(t==="SFX"?u=`${d}$`:u=`^${d}`);let o=null;a!="0"&&(t==="SFX"?o=`${a}$`:o=`${a}`);var h=U.parseCodes(l,s);return new I(c,u,o,h)}getMemoRegex(e){return e?I.regex[e]===void 0&&(I.regex[e]=this.getRegex(e)):I.regex[e]=null,I.regex[e]}getRegex(e){try{return new RegExp(e)}catch{return null}}};I.regex=Object.create(null);var W=class{constructor(e,t,s,n){if(!(e&&t&&s)){let a=`dictionary (${e}) || affData (${t}) || wordsData (${s}) 
				not provided.unlike Typo.js, all are required by the constructor.`;throw new Error(a)}this.dictionary=e,this.affData=t,this.wordsData=s,this.settings=n!=null?n:Object.create(null),this.rules={},this.combinableRules={},this.dictionaryMap=new Map,this.compoundRules=[],this.compoundRuleCodes={},this.replacementTable=[],this.flags="flags"in this.settings?this.settings.flags:Object.create(null),this.memoized={},this.loaded=!1,this.alphabet="",this.setup()}checkExact(e){if(!this.loaded)throw"Dictionary not loaded.";let t=this.dictionaryMap.get(e),s,n;if(typeof t=="undefined"){if("COMPOUNDMIN"in this.flags&&e.length>=this.flags.COMPOUNDMIN){for(s=0,n=this.compoundRules.length;s<n;s++)if(e.match(this.compoundRules[s]))return!0}}else{if(t===null)return!0;if(typeof t=="object"){for(s=0,n=t.length;s<n;s++)if(!this.hasFlag(e,"ONLYINCOMPOUND",[t[s]]))return!0}}return!1}suggest(e,t){if(!this.loaded)throw"Dictionary not loaded.";let s="";if(t=t||5,this.memoized.hasOwnProperty(e)){var n=this.memoized[e].limit;if(t<=n||this.memoized[e].suggestions.length<n)return this.memoized[e].suggestions.slice(0,t)}if(this.check(e))return[];for(var a=0,r=this.replacementTable.length;a<r;a++){var d=this.replacementTable[a];if(e.indexOf(d[0])!==-1){var i=e.replace(d[0],d[1]);if(this.check(i))return[i]}}if(!this.alphabet){this.alphabet="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ","TRY"in this.flags&&(this.alphabet+=this.flags.TRY),"WORDCHARS"in this.flags&&(this.alphabet+=this.flags.WORDCHARS);var l=this.alphabet.split("");l.sort();for(var c={},a=0;a<l.length;a++)c[l[a]]=!0;this.alphabet="";for(var u in c)this.alphabet+=u}function o(m,g){var w={},b,x,E,R,C,L,T=this.alphabet.length;if(typeof m=="string"){var $=m;m={},m[$]=!0}for(var $ in m)for(b=0,R=$.length+1;b<R;b++){var k=[$.substring(0,b),$.substring(b)];if(k[1]&&(L=k[0]+k[1].substring(1),(!g||this.check(L))&&(L in w?w[L]+=1:w[L]=1)),k[1].length>1&&k[1][1]!==k[1][0]&&(L=k[0]+k[1][1]+k[1][0]+k[1].substring(2),(!g||this.check(L))&&(L in w?w[L]+=1:w[L]=1)),k[1]){var z=k[1].substring(0,1).toUpperCase()===k[1].substring(0,1)?"uppercase":"lowercase";for(x=0;x<T;x++){var D=this.alphabet[x];z==="uppercase"&&(D=D.toUpperCase()),D!=k[1].substring(0,1)&&(L=k[0]+D+k[1].substring(1),(!g||this.check(L))&&(L in w?w[L]+=1:w[L]=1))}}if(k[1])for(x=0;x<T;x++){var z=k[0].substring(-1).toUpperCase()===k[0].substring(-1)&&k[1].substring(0,1).toUpperCase()===k[1].substring(0,1)?"uppercase":"lowercase",D=this.alphabet[x];z==="uppercase"&&(D=D.toUpperCase()),L=k[0]+D+k[1],(!g||this.check(L))&&(L in w?w[L]+=1:w[L]=1)}}return w}function h(m){let g=o(m,!1),b=o(g,!0);for(var x in g)this.check(x)&&(x in b?b[x]+=g[x]:b[x]=g[x]);let E,R,C=[];for(E in b)b.hasOwnProperty(E)&&C.push([E,b[E]]);function L(z,D){let Q=z[1],ee=D[1];return Q<ee?-1:Q>ee?1:D[0].localeCompare(z[0])}C.sort(L).reverse();let T=[],$="lowercase";m.toUpperCase()===m?$="uppercase":m.substr(0,1).toUpperCase()+m.substr(1).toLowerCase()===m&&($="capitalized");let k=t;for(E=0;E<Math.min(k,C.length);E++)$==="uppercase"?C[E][0]=C[E][0].toUpperCase():$==="capitalized"&&(C[E][0]=C[E][0].substr(0,1).toUpperCase()+C[E][0].substr(1)),!this.hasFlag(C[E][0],"NOSUGGEST",null)&&T.indexOf(C[E][0])==-1?T.push(C[E][0]):k++;return T}return this.memoized[e]={suggestions:h(e),limit:t},this.memoized[e].suggestions}setup(){let e=0,t=0,s=0,n=0;for(this.rules=this._parseAFF(this.affData),this.combinableRules=Object.assign({},...Object.entries(this.rules).filter(([i,l])=>l.combinable).map(([i,l])=>({[i]:l}))),this.compoundRuleCodes=Object.create(null),e=0,s=this.compoundRules.length;e<s;e++){var a=this.compoundRules[e];for(t=0,n=a.length;t<n;t++)this.compoundRuleCodes[a[t]]=[]}"ONLYINCOMPOUND"in this.flags&&(this.compoundRuleCodes[this.flags.ONLYINCOMPOUND]=[]);let r=`typo.ts loaded ${this.dictionary} dictionary`;console.time(r),this.parseDIC(this.wordsData),console.timeEnd(r);for(let i in this.compoundRuleCodes)this.compoundRuleCodes[i].length===0&&delete this.compoundRuleCodes[i];for(e=0;e<this.compoundRules.length;e++){let i=this.compoundRules[e],l="";for(t=0,n=i.length;t<n;t++){var d=i[t];d in this.compoundRuleCodes?l+="("+this.compoundRuleCodes[d].join("|")+")":l+=d}this.compoundRules[e]=new RegExp(l,"i")}this.loaded=!0}_parseAFF(e){let t=/\r?\n/,s=/\s+/,n=Object.create(null),a,r,d,i,l,c,u,o,h=e.split(t);for(l=0,u=h.length;l<u;l++){if(a=this._removeAffixComments(h[l]),a=a.trim(),!a)continue;let w=a.split(s),b=w[0],x=[];if(b=="PFX"||b=="SFX"){var m=w[1],g=w[2];let E=parseInt(w[3],10);for(c=l+1,o=l+1+E;c<o;c++)r=h[c],x.push(I.fromLine(r,b,this.flags));n[m]=new U(m,b,g==="Y",x),l+=E}else if(b==="COMPOUNDRULE"){for(d=parseInt(w[1],10),c=l+1,o=l+1+d;c<o;c++)a=h[c],i=a.split(/\s+/),this.compoundRules.push(i[1]);l+=d}else b==="REP"?(i=a.split(/\s+/),i.length===3&&this.replacementTable.push([i[1],i[2]])):this.flags[b]=w[1]}return n}_removeAffixComments(e){return e.match(/^\s*#/)?"":e}addWord(e,t){let s=this.dictionaryMap.get(e),n=t.length>0;s===void 0?n?this.dictionaryMap.set(e,t):this.dictionaryMap.set(e,null):s===null?n&&this.dictionaryMap.set(e,t):n&&s.push.apply(s,t)}parseDIC(e){e=this.removeDicComments(e);let t=e.split(/\r?\n/);this.dictionaryMap.clear();let s=[],n=[],a=0,r;for(let i=0,l=t.length;i<l;i++){let[c,u]=t[i].split("/",2);if(u){r=U.parseCodes(u,this.flags),a=r.length,s.length=0,n.length=0,(!("NEEDAFFIX"in this.flags)||r.indexOf(this.flags.NEEDAFFIX)==-1)&&this.addWord(c,r);for(let o=0;o<a;o++){let h=r[o],m=this.rules[h];if(s.length=0,n.length=0,m&&(m.applyRule(c,this.rules,s),m.combinable)){let b=s.length;for(let x=0;x<b;x++){let E=s[x];for(let R=0;R<a;R++){var d=this.combinableRules[r[R]];d&&m.type!==d.type&&d.applyRule(E,this.rules,n)}}}s.push.apply(s,n);let g=new Set(s),w=g.size;for(let b of g)this.addWord(b,[]);h in this.compoundRuleCodes&&this.compoundRuleCodes[h].push(c)}}else this.addWord(c.trim(),[])}}removeDicComments(e){return e=e.replace(/^\t.*$/mg,""),e}check(e){if(!this.loaded)throw"Dictionary not loaded.";var t=e.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(t===""||this.checkExact(t))return!0;if(t.toUpperCase()===t){var s=t[0]+t.substring(1).toLowerCase();if(this.hasFlag(s,"KEEPCASE",null))return!1;if(this.checkExact(s)||this.checkExact(t.toLowerCase()))return!0}var n=t[0].toLowerCase()+t.substring(1);if(n!==t){if(this.hasFlag(n,"KEEPCASE",null))return!1;if(this.checkExact(n))return!0}return!1}hasFlag(e,t,s){if(!this.loaded)throw"Dictionary not loaded.";if(t in this.flags){if(typeof s=="undefined"){let n=this.dictionaryMap.get(e);s=Array.prototype.concat.apply([],n)}if(s&&s.indexOf(this.flags[t])!==-1)return!0}return!1}};var P;(function(v){v[v.Ascending=0]="Ascending",v[v.Descending=1]="Descending"})(P||(P={}));var N=class{constructor(e,t,s,n){this.label=e,this.offset=t,this.limit=s,this.extended=n}},Y=class{constructor(e,t,s,n){this.primaryHeading=e,this.primarySort=t,this.secondaryHeading=s,this.secondarySort=n}};var j=class{static createElement(e,t,s,n,a,r,d,i,l,c,u){let o=new j(t,s,n,a,r,d,i,l,c,u);return e.appendChild(o.baseElement),y.postContentHeight(),o}static generateFormatedColumnNumber(e){return`${e.toString().padStart(2,"0")}.`}static sortResultsHelper(e,t,s,n,a,r,d){return s&&r?d===P.Ascending?t-a:a-t:e!==void 0&&n!==void 0?d===P.Ascending?e.localeCompare(n):n.localeCompare(e):(console.warn(`sort failure: ${e}, ${n}`),0)}constructor(e,t,s,n,a,r,d,i,l,c){this.paginationEdgeRangeDesktop=2,this.paginationEdgeRangeMobile=1,this.baseElement=document.createElement("div"),this.header=s,this.results=a,this.resultsSort=r,this.headings=n,this.perPage=t,this.project=e,this.resultsCount=a.length,this.resultsOffset=0,this.cellRenderer=i,this.rowRenderer=d,this.cellHandler=l,this.exportExtra=c,this.scrollHandler=u=>{var o;let h=u.data;if(h==null){this.setStickyHeaders(0);return}let m=h.data,g=(o=m==null?void 0:m.reportScrollY)!==null&&o!==void 0?o:null;g===null||(h==null?void 0:h.target)!=="interrobot"||this.setStickyHeaders(g)},this.navHandler=u=>{this.resultsOffset=parseInt(u.target.dataset.offset),this.renderSection(),y.postContentHeight()},this.browserLinkHandler=u=>{let o=u.target,h=!0;y.postOpenResourceLink(Number(o.dataset.id),h),u.preventDefault(),u.stopPropagation()},this.appLinkHandler=u=>{let o=u.target,h=!1;y.postOpenResourceLink(Number(o.dataset.id),h),u.preventDefault(),u.stopPropagation()},this.sortableHandler=u=>{if(u.preventDefault(),this.results.length===0)return;let h=u.currentTarget.dataset.heading,m;this.resultsSort.primaryHeading===h?m=this.resultsSort.primarySort===P.Ascending?P.Descending:P.Ascending:m=P.Ascending,this.resultsSort.primaryHeading=h,this.resultsSort.primarySort=m,this.resultsOffset=0,this.sortResults(),this.renderSection();let g={target:"interrobot",data:{reportScrollToTop:!0}};window.parent.postMessage(g,"*")},this.downloadMenuHandler=u=>{let o=this.baseElement.querySelector(".info__dl");o!==null&&(o.classList.toggle("visible"),u.preventDefault())},this.downloadHandler=u=>{var o,h;u.preventDefault(),this.baseElement.querySelector(".info__dl").classList.remove("visible");let g=this.headings.concat(Object.keys((o=this.exportExtra)!==null&&o!==void 0?o:{})),w=!1;g[0]===""&&(w=!0,g.shift());let b=[];for(let E=0;E<this.results.length;E++){let R=this.results[E],C=Object.values((h=this.exportExtra)!==null&&h!==void 0?h:{}),L=[];for(let T of C)if(typeof T=="function"){let $=T(E);L.push($)}else L.push(T.toString());w?b.push(R.slice(1).concat(L)):b.push(R.concat(L))}let x={target:"interrobot",data:{reportExport:{format:u.target.dataset.format,headers:g,rows:b}}};window.parent.postMessage(x,"*")},this.renderSection()}getHeadingIndex(e){return this.headings.indexOf(e)}getResults(){return this.results}getHeadings(){return this.headings}getResultsSort(){return this.resultsSort}setStickyHeaders(e){let t=this.baseElement.querySelector("thead"),s=t==null?void 0:t.parentElement;if(t===null||s===null)return;let n=s.getBoundingClientRect();n.top<=e&&e<=n.bottom?(t.classList.add("sticky"),t.style.top=`${e-n.top}px`):(t.classList.remove("sticky"),t.style.top="auto")}setOffsetPage(e){let t=e*this.perPage;t!==this.resultsOffset&&(this.resultsOffset=t,this.renderSection())}sortResults(){let e=this.resultsSort.primaryHeading,t=this.resultsSort.primarySort,s=this.getHeadingIndex(e),n=this.resultsSort.secondaryHeading,a=this.resultsSort.secondarySort,r=this.getHeadingIndex(n),d=/^[-+]?[0-9]+([,.]?[0-9]+)?$/;if(s===-1){console.warn(`heading '${this.resultsSort.primaryHeading}' not found, aborting sort`);return}let i=(l,c)=>{let u=l[s],o=d.test(u)?parseFloat(u):null,h=o!==null&&!isNaN(o),m=c[s],g=d.test(m)?parseFloat(m):null,w=g!==null&&!isNaN(g);if(u===m){let b=l[r],x=parseFloat(b),E=!isNaN(x),R=c[r],C=parseFloat(R),L=!isNaN(C);return j.sortResultsHelper(b,x,E,R,C,L,a)}else return j.sortResultsHelper(u,o,h,m,g,w,t)};if(this.results.sort(i),this.headings[0]==="")for(let l=0;l<this.results.length;l++)this.results[l][0]=j.generateFormatedColumnNumber(l+1)}getColumnClass(e){return`column__${e?e.replace(/[^\w]+/g,"").toLowerCase():"empty"}`}renderTableHeadings(e){let t=[],s=`<svg version="1.1" class="chevrons" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
	        x="0px" y="0px" width="12px" height="20px" viewBox="6 2 12 20" enable-background="new 6 2 12 20" xml:space="preserve">
            <title>north/south chevrons</title>
	        <polyline class="d2" fill="none" stroke="#000000" stroke-miterlimit="10" points="7.32,16.655 12.015,21.208 16.566,16.633"/>
	        <polyline class="d1" fill="none" stroke="#000000" stroke-miterlimit="10" points="7.314,13.274 12.01,17.827 16.561,13.253"/>
	        <polyline class="u2" fill="none" stroke="#000000" stroke-miterlimit="10" points="16.685,10.594 12.115,6.041 7.439,10.615"/>
	        <polyline class="u1" fill="none" stroke="#000000" stroke-miterlimit="10" points="16.679,7.345 12.11,2.792 7.434,7.365"/>
        </svg>`;for(let n of e){let a=f.htmlEncode(this.getColumnClass(n)),r=`${f.htmlEncode(n)}`,d=a!=="column__empty",i="",l="";d?(i=`<a class="sortable" data-heading="${f.htmlEncode(n)}" href="#">${f.htmlEncode(r)}</a>`,l=`<a title="${r}" class="sortable" data-heading="${f.htmlEncode(n)}" href="#">
                    ${s}<span class="reader">${r}</span></a>`):i=`${f.htmlEncode(r)}`,t.push(`<th class="${a}">`+i+" "+l+"</th>")}return t.join("")}renderTableData(){let e=[],t=this.getHeadingIndex("ID"),s=this.results.slice(this.resultsOffset,this.resultsOffset+this.perPage);for(let n=0;n<s.length;n++){let a=s[n],r=this.headings.reduce((l,c,u)=>({...l,[c]:a[u]}),{}),d=[],i=[];if(this.rowRenderer){let l=this.rowRenderer(a,this.headings);"classes"in l&&i.push.apply(i,l.classes)}for(let l=0;l<a.length;l++){let c=[],u=this.headings[l];c.push(this.getColumnClass(u));let o=a[l],h=Number(o),m=!isNaN(h)||o.match(/^\d+\/\d+$/)!==null;m?c.push("numeric"):f.isUrl(o)&&c.push("url");let g=`${o}`,w=Number(o),b=this.cellRenderer&&u in this.cellRenderer?this.cellRenderer[u]:null;if(b){let x=b(o,r,n);g=x.content,c.push(...x.classes)}else m&&!isNaN(w)&&u!==""&&u!=="ID"?g=`${Number(o).toLocaleString()}`:c.indexOf("url")>-1&&(g=`<a class="ulink" data-id="${f.htmlEncode(a[t])}" 
                        href="${f.htmlEncode(o)}">${f.htmlEncode(o)}</a>`);d.push(`<td class="${f.htmlEncode(c.join(" "))}">${g}</td>`)}e.push(`<tr class="${f.htmlEncode(i.join(" "))}">${d.join("")}</tr>`)}return e}renderSection(){this.removeHandlers(),this.resultsSort.primarySort!==null&&this.resultsSort.primaryHeading!==null&&this.sortResults();let e=this.renderTableData();if(e.length===0){this.baseElement.innerHTML=`<section>${this.header}<p>No results found.</p></section>`;return}let t=[],s=this.getPagination(),n={"\u25C0\u25C0":!0,"\u25B6\u25B6":!0};for(let c=0;c<s.length;c++){let u=s[c],o=[];u.label in n?o.push(u.label=="\u25C0\u25C0"?"rewind":"fastforward"):u.offset===this.resultsOffset?o.push("current"):u.extended&&o.push("extended"),t.push(`<button class="${o.join(" ")}" data-offset="${u.offset}">${u.label}</button>`)}let a=this.resultsOffset+1,r=Math.min(this.resultsCount,this.resultsOffset+this.perPage),d=this.isCorePlugin()?"`":"\u229E",i=`<section>
            ${this.header}
            <hgroup>
                <div class="info">
                    <span class="info__dl export">
                        <button class="icon">${d}</button>
                        <ul class="export__ulink">
                            <li><a class="ulink" href="#" data-format="csv">Export CSV</a></li>
                            <li><a class="ulink" href="#" data-format="xlsx">Export Excel</a></li>
                        </ul>
                    </span>
                    <span class="info__results"><span class="info__results__nobr">
                        ${a.toLocaleString()} - ${r.toLocaleString()}</span> 
                        <span class="info__results__nobr">of ${this.resultsCount.toLocaleString()}</span></span>
                </div>
                <nav>${t.join("")}</nav>
            </hgroup>
            <div class="datatable">
                <table>
                    <thead>
                        <tr>
                            ${this.renderTableHeadings(this.headings)}                        
                        </tr>
                    </thead>
                    <tbody>
                        ${e.join("")}
                    </tbody>
                </table>
            </div>`;this.baseElement.innerHTML=i;let l=this.baseElement.querySelectorAll("a.sortable");for(let c=0;c<l.length;c++){let u=l[c];if(u.classList.remove("ascending","descending"),u.dataset.heading===this.resultsSort.primaryHeading){let o=this.resultsSort.primarySort==P.Ascending?"ascending":"descending";u.classList.add(o)}}this.addHandlers()}addHandlers(){this.applyHandlers(!0)}removeHandlers(){this.applyHandlers(!1)}isCorePlugin(){let e=window.self!==window.top,t=!1;if(e)try{t=!!window.parent.location.href}catch{t=!1}return e&&t}applyHandlers(e){let t=e?"addEventListener":"removeEventListener",s=this.baseElement.querySelectorAll("nav button");for(let o=0;o<s.length;o++)s[o][t]("click",this.navHandler);let n=this.baseElement.querySelectorAll(".info__dl .ulink");for(let o=0;o<n.length;o++)n[o][t]("click",this.downloadHandler);let a=this.baseElement.querySelector(".info__dl button");if(a!==null&&(a[t]("click",this.downloadMenuHandler),matchMedia("(pointer:fine)").matches&&!/android/i.test(window.navigator.userAgent))){let h=this.baseElement.querySelector(".info__dl");h==null||h.classList.add("hasmouse")}this.baseElement.querySelector("thead")&&(window[t]("message",this.scrollHandler),window[t]("resize",this.scrollHandler));let d=this.baseElement.querySelector("table");if(d){let o=document.querySelector(".wrap");d[t]("touchstart",h=>{o==null||o.classList.add("dragging"),h.stopPropagation()},{passive:!0}),d[t]("touchend",h=>{o==null||o.classList.remove("dragging"),h.stopPropagation()},{passive:!0}),d[t]("touchmove",h=>{h.stopPropagation()},{passive:!0})}let i=this.baseElement.querySelectorAll("button.custom");if(this.cellHandler)for(let o of i)o[t]("click",this.cellHandler);let l=this.baseElement.querySelectorAll("td.url a");for(let o=0;o<l.length;o++)l[o][t]("click",this.browserLinkHandler);for(let o=0;o<s.length;o++)s[o][t]("click",this.navHandler);let c=this.baseElement.querySelectorAll("td.column__id a");for(let o=0;o<c.length;o++)c[o][t]("click",this.appLinkHandler);let u=this.baseElement.querySelectorAll("th a.sortable");for(let o=0;o<u.length;o++)u[o][t]("click",this.sortableHandler)}getPagination(){let e=[],t=0,s=this.paginationEdgeRangeDesktop,n=this.paginationEdgeRangeMobile,a=Math.ceil(this.resultsOffset/this.perPage),r=Math.max(s-a,0),d=Math.max(n-a,0);s+=Math.max(r,0),n+=Math.max(d,0);let i=this.resultsOffset;for(;i>0&&t<s;){i-=this.perPage;let m=`${i/this.perPage+1}`,g=new N(m,i,this.perPage,t>=n);e.push(g),t++}if(this.resultsOffset>0&&(e.push(new N("\u25C0",this.resultsOffset-this.perPage,this.perPage,!1)),e.push(new N("\u25C0\u25C0",0,this.perPage,!1))),e.reverse(),this.resultsCount>this.perPage){let m=`${this.resultsOffset/this.perPage+1}`,g=new N(m,this.resultsOffset,this.perPage,!1);e.push(g)}let l=this.paginationEdgeRangeDesktop,c=this.paginationEdgeRangeMobile,u=Math.ceil(this.resultsOffset/this.perPage),o=Math.max(l-u,0),h=Math.max(c-u,0);for(l+=Math.max(o,0),c+=Math.max(h,0),t=0,i=this.resultsOffset+this.perPage;i<this.resultsCount&&t<l;){let m=`${i/this.perPage+1}`,g=new N(m,i,this.perPage,t>=c);e.push(g),i+=this.perPage,t++}if(this.resultsCount>this.resultsOffset+this.perPage){e.push(new N("\u25B6",this.resultsOffset+this.perPage,this.perPage,!1));let m=this.resultsCount-this.resultsCount%this.perPage;m=m==this.resultsCount?m-this.perPage:m,e.push(new N("\u25B6\u25B6",m,this.perPage,!1))}return e}};var G=class{constructor(e,t,s,n){if(["archimedean","rectangular"].indexOf(s)===-1)throw new Error("invalid spiral value");this.id=e,this.name=t,this.spiral=s,this.separated=n}toString(){return`{ id: ${this.id}, name: ${this.name}, spiral: ${this.spiral}, separated: ${this.separated},]`}},K=class{constructor(e,t){this.count=0,this.word=e,this.count=t}incrementCount(){this.count++}getCount(){return this.count}getWord(){return this.word}toString(){return`[${this.word} => ${this.count}]`}},p=class extends y{static getWordLayoutFontSize(e,t){if(p.cloudWordLayoutMemo===void 0){let i=0,l=1e7;e.forEach(o=>{i=Math.max(i,o.value),l=Math.min(l,o.value)});let c=Math.log1p(l),u=Math.log1p(i);p.cloudWordLayoutMemo={count:e.length,min:l,max:i,minLog:c,maxLog:u}}let s=p.cloudWordLayoutMemo.minLog,n=p.cloudWordLayoutMemo.maxLog,a=(Math.log1p(t)-n)/(s-n),r=p.wordsMaxOutput-(p.wordsMaxOutput-p.wordsMinOutput)*Math.pow(a,2);return Math.round(Math.min(Math.max(r,p.wordsMinOutput),p.wordsMaxOutput))}constructor(){super(),this.language="en_US",this.wordMap=new Map,this.wordMapPresentation=[],this.resultsMap=new Map,this.perPage=25,this.table=null,this.progress=null,this.stopwordsTruth=X.getStopwordsTruth("en"),this.deleteWordHandler=async e=>{let t=e.target;for(let s=0;s<this.wordMapPresentation.length;s++)if(this.wordMapPresentation[s].word===t.dataset.word){this.wordMapPresentation.splice(s,1),await this.displayResults();break}},this.addWordHandler=async e=>{e.preventDefault();let s=e.target.form,n=s==null?void 0:s.querySelector("input[name='word']"),a=s==null?void 0:s.querySelector("input[name='count']"),r=n.value,d=Math.ceil(Number(a.value));if(r.length<this.minWordLength||d<=0){s.classList.add("error"),window.setTimeout(()=>{s.classList.remove("error")},900),e.preventDefault();return}let i=new K(r,d);this.wordMapPresentation.push(i),this.wordMapPresentation=this.sortAndTruncatePresentation(this.wordMapPresentation),await this.displayResults()},this.cloudExpandHandler=e=>{e.preventDefault();let t=document.querySelector(".cloud__wrapper");if(t)document.fullscreenElement?(document.exitFullscreen(),t.classList.remove("fullscreen")):(t==null||t.requestFullscreen(),t.classList.add("fullscreen"));else return},this.cloudRefreshHandler=e=>{e.preventDefault(),this.displayResults()},this.cloudDownloadHandler=async e=>{e.preventDefault();let t=d3.select(`#${p.svgId}`).node(),s=new XMLSerializer().serializeToString(t),n=document.createElement("canvas"),a=document.createElement("img");n.width=p.svgWidth,n.height=p.svgHeight;let d="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(s)));a.onload=async i=>{let l=n.getContext("2d",{willReadFrequently:!0});l.fillStyle=this.backgroundColor,l.fillRect(0,0,n.width,n.height),l.drawImage(a,0,0);let c=n.toDataURL("image/png");if(await y.postApiRequest("GetVersion",{})){let o={target:"interrobot",data:{reportExport:{format:"datauri",datauri:c}}};window.parent.postMessage(o,"*")}else{let o=document.createElement("a"),m=`wordcloud-${new Date().toISOString().slice(0,16).replace(/[\-\:T]/g,"")}.png`;o.download=m,o.href=c,o.click();let g=document.querySelector(".cloud__message");g&&(g.innerText=`Saved ${m} to ./Downloads`,g.classList.add("visible"),window.setTimeout(()=>{g.classList.remove("visible"),g.innerText=""},5e3))}},a.src=d},this.index()}async index(){let e=await O.getApiProject(this.getProjectId());this.render(`
            ${H.standardHeading(e,p.meta.title)}
            ${H.standardForm(`
            <form class="main__form__standard main__form__ltr main__form__wordcloud" id="WordcloudForm" spellcheck="false">
                <label>
                    <span>Strategy</span>
                    <select name="strategy">
                        <option value="1">Frequency</option>
                        <option value="0">Jargon</option>

                    </select>
                </label>
                <label>
                    <span>Layout</span>
                    <select name="layout">
                    </select>
                </label>
                <label>
                    <span>Min Word Length</span>
                    <select name="minWordLength">
                        <option value="3">3 characters</option>
                        <option value="4">4 characters</option>
                        <option value="5">5 characters</option>
                    </select>
                </label>
                <label>
                    <span>Font Family</span>
                    <input type="text" name="fontFamily" placeholder="Optional font" />
                </label>
                <label>
                    <span>Background</span>
                    <input type="color" name="backgroundColor" value="#ffffff" />
                    <span class="main__form__color">#??????</span>
                </label>
                <div><button class="submit">Generate</button></div>
            </form>
            <div id="WordcloudFormProgress"></div>`)}
            ${H.standardResults()}
        `);let t=document.querySelector("select[name='strategy']"),s=document.querySelector("select[name='minWordLength']"),n=document.querySelector("select[name='layout']"),a=document.querySelector("input[name='backgroundColor']"),r=document.querySelector("input[name='fontFamily']"),d=document.getElementById("WordcloudFormProgress");for(let o=0;o<p.layouts.length;o++){let h=p.layouts[o],m=document.createElement("option");m.innerText=h.name,m.setAttribute("value",`${h.id}`),n.appendChild(m)}r.addEventListener("mousedown",()=>{let o="Fontlist",h=document.getElementById(o);h===null?(h=document.createElement("div"),h.id=o,h.style.width=`${r.offsetWidth}px`,h.classList.add("fontlist"),["Arial","Georgia","Impact","Palatino","Tahoma","Times New Roman","Verdana"].forEach(g=>{let w=document.createElement("a");w.innerText=g,w.href="#",h.appendChild(w),w.addEventListener("mousedown",b=>{r.value=g,h.style.display="none";let x=new Event("change",{bubbles:!0,cancelable:!0});r.dispatchEvent(x)}),w.addEventListener("click",b=>{b.preventDefault()})}),r.parentElement.classList.add("fontlist__label"),r.parentElement.appendChild(h)):(h.style.display="block",h.style.width=`${r.offsetWidth}px`),r.addEventListener("blur",()=>{h.style.display="none"})});let i={},l=[t,s,n,a,r];await this.initData(i,l);let c=()=>{var o;this.strategy=Number(t.value),this.layout=(o=p.layouts.find(m=>m.id.toString()==n.value))!==null&&o!==void 0?o:p.layouts[0],this.minWordLength=Number(s.value),this.backgroundColor=a.value,this.fontFamily=r.value?r.value:"Montserrat SemiBold";let h=document.querySelector(".main__form__color");h&&(h.innerText=this.backgroundColor)};a.addEventListener("change",o=>{c()}),this.progress=F.createElement(d,"Scanning: "),this.strategy=Number(t.value),c();let u=document.querySelector("button");u.addEventListener("click",async o=>{o.preventDefault(),u.setAttribute("disabled","disabled"),c();try{await this.process()}catch(h){console.error(h)}finally{u.removeAttribute("disabled")}}),y.postContentHeight()}async process(){await this.data.updateData();let e="/hunspell",t={method:"GET",headers:{Accept:"text/plain","Content-Type":"text/plain; charset=UTF-8"}},[s,n]=await Promise.all([fetch(`${p.baseMediaPath}/hunspell/${this.language}.aff`,t).then(l=>l.text()),fetch(`${p.baseMediaPath}/hunspell/${this.language}.dic`,t).then(l=>l.text())]);p.typo=new W(this.language,s,n),this.wordMap.clear();let a=this.getProjectId(),r="headers: text/html",d=new S({project:a,query:r,fields:"content",type:q.Any,includeExternal:!1,includeNoRobots:!1});await M.execute(d,this.resultsMap,async l=>{await this.wordcloudResultHandler(l)},!0,!1,"Finding jargon\u2026");let i=[...this.wordMap.values()];this.wordMapPresentation=this.sortAndTruncatePresentation(i),await this.report()}async report(){await this.displayResults()}sortAndTruncatePresentation(e){return e=e.filter(t=>t.getWord().length>=this.minWordLength),e.sort((t,s)=>s.getCount()-t.getCount()),e.slice(0,p.maxPresentationWords)}async displayResults(){var e;p.cloudWordLayoutMemo=void 0,this.removeHandlers();let t=[];t.push('<div class="cloud__wrapper">'),t.push(`<form action="." method="get" class="cloud__actions">
            <div>
            <button class="cloud__action" aria-label="Expand">
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="128px"
                height="128px" viewBox="388.5 1532.71 128 128" xml:space="preserve">
                <path d="M508.938,1653.148h-34.469v-7h27.469v-27.47h7V1653.148z M430.529,1653.148h-34.469v-34.47h7v27.47h27.469V1653.148z
                    M508.938,1574.741h-7v-27.47h-27.469v-7h34.469V1574.741z M403.06,1574.741h-7v-34.47h34.469v7H403.06V1574.741z"/>
            </svg>
            </button>
            <button class="cloud__action" aria-label="Refresh">
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="128px"
                height="128px" viewBox="1188.5 1372.466 128 128" xml:space="preserve">
                <path d="M1210.944,1399.189c20.188-20.277,52.974-20.333,73.239-0.146l15.24,13.926v-16.084c0-2.383,8.632-2.383,8.632,0v25.896
                    c0,2.384-1.934,4.316-4.315,4.316h-25.896c-2.383,0-2.383-8.633,0-8.633h14.791l-14.342-13.14
                    c-0.045-0.044-0.101-0.089-0.134-0.135c-16.522-16.499-43.15-16.893-60.134-0.876c-17.343,16.354-18.142,43.666-1.788,61.01
                    c16.355,17.343,43.668,18.142,61.01,1.786c1.743-1.64,4.464-1.562,6.104,0.169c1.642,1.743,1.574,4.462-0.168,6.104
                    c-9.587,9.104-22.322,14.174-35.552,14.14h-0.696c-28.324-0.382-51.097-23.457-51.097-51.793
                    C1195.838,1422.028,1201.267,1408.889,1210.944,1399.189z"/>
            </svg>
            </button>
            <button class="cloud__action" aria-label="Download">
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="128px"
                    height="128px" viewBox="1028.5 1212.5 128 128" xml:space="preserve">
                    <path d="M1066.222,1283.45l23.792,23.762c1.328,1.33,3.645,1.33,4.973,0l23.839-23.839c-0.018-0.049-0.116-0.781-1.131-2.058 c-1.345-1.692-3.121-2.872-3.875-2.872l-17.801,17.788v-75.353c-0.15-0.188-1.402-0.727-3.519-0.727s-3.368,0.539-3.54,0.814 l0.021,75.265l-17.834-17.832c-0.722,0.044-2.498,1.224-3.842,2.916C1066.291,1282.592,1066.192,1283.323,1066.222,1283.45z"/>
                    <path d="M1040.056,1290.463c-2.116,0-3.367,0.538-3.539,0.813l0.021,40.054c0,0.383,0,1.126,0.062,1.456 c0.33,0.062,1.073,0.062,1.456,0.062h108.889c0.383,0,1.126,0,1.456-0.062c0.062-0.33,0.062-1.073,0.062-1.456v-40.142 c-0.15-0.188-1.401-0.726-3.518-0.726c-2.115,0-3.366,0.538-3.538,0.813l0.021,34.537h-97.855v-34.625 C1043.422,1291.001,1042.171,1290.463,1040.056,1290.463z"/>                </svg>
            </button>
            </div>
            <div class="cloud__message">

            </div>
        </form>`);let s="";try{let m=await(await fetch(p.embedFont)).blob(),g=new FileReader;await new Promise(w=>{g.onloadend=()=>w(),g.readAsDataURL(m)}),s=g.result.toString().split(",")[1]}catch{console.warn("default font not embedded in svg")}t.push(`<svg class="cloud ${this.layout.spiral}" id="${p.svgId}" width="${p.svgWidth}" height="${p.svgHeight}"
            viewBox="0 0 ${p.svgWidth} ${p.svgHeight}" fill="${this.backgroundColor}"
            preserveAspectRatio="xMidYMid meet">
            <style>
            @font-face {
                font-family: 'Montserrat SemiBold';
                font-style: normal;
                font-weight: 600;
                src: url("data:font/woff2;base64,${s}") format("woff2");
            }
            svg {
                font-family: "Montserrat SemiBold";
            }
            text {
                stroke: #cccccc44;
                paint-order: stroke;
            }
            </style>
             </svg>
            </svg>`),t.push("</div>");let n=document.querySelector(".main__results");if(n!==null){n.innerHTML=t.join("");let h=n.querySelector("svg.cloud");h!==null&&h.style.backgroundColor&&(h.style.backgroundColor=(e=this.backgroundColor)!==null&&e!==void 0?e:"#ffffff")}let a=`<h2><span class="keywords">Word Cloud Terms</span></h2>
            <div>
                <p>
                Review word cloud data and modify terms (maximum ${p.maxPresentationWords} words).
                </p>
                <form id="WordcloundManagerAdd" action="." method="GET">
                    <input type="text" name="word" placeholder="term" required />
                    <input type="number" name="count" placeholder="count" required />
                    <button>Add Term</button>
                </form>
            </div>`,r=["","TERM","COUNT"],d=[];for(let h=0;h<this.wordMapPresentation.length;h++){let m=this.wordMapPresentation[h],g=f.htmlEncode(m.word);d.push([j.generateFormatedColumnNumber(h+1),`${m.getWord()}`,`${m.getCount()}`])}let i={},l=async h=>{h.target&&this.deleteWordHandler(h)},c=null,u={TERM:(h,m)=>({classes:["term"],content:`<strong>${h}</strong>
                        <button class="custom" data-word="${h}">
                        <span>\xD7</span> Remove</button>`})},o=new Y("COUNT",P.Descending,"TERM",P.Ascending);this.table=j.createElement(n,this.getProjectId(),this.perPage,a,r,d,o,c,u,l,i),this.addHandlers(),this.generateCloud(),y.postContentHeight()}draw(e){if(this.cloudLayout===null){console.error("layout unavailable (not ready)");return}if(e.length===0){console.error("no words to add to cloud");return}e.reverse();let t=p.svgWidth/2,s=p.svgHeight/2,n=d3.scaleOrdinal(d3.schemeCategory10),a=`translate(${t},${s})`,d=d3.select(`#${p.svgId}`).append("g");d.attr("transform",a),d.selectAll("text").data(e).enter().append("text").style("font-size",c=>`${p.getWordLayoutFontSize(e,c.value)}px`).style("font-family",c=>`${c.fontFamily}`).style("fill",(c,u)=>n(u)).attr("text-anchor","middle").attr("transform",c=>`translate(${c.x},${c.y})rotate(${c.rotate})`).text(c=>c.text);let l=document.getElementById(p.svgId).querySelectorAll("text");for(let c=0;c<l.length;c++){let u=l[c],o=parseInt(u.style.fontSize,10);u.classList.add("zsort",`zsort${o}`)}}generateCloud(){let e=0,t=[];for(let n=0;n<this.wordMapPresentation.length;n++){let a=this.wordMapPresentation[n],r=a.getWord(),d=a.getCount();e=Math.max(e,d),t.push(a)}let s=t.map(n=>({text:n.getWord(),value:n.getCount(),fontFamily:this.fontFamily}));this.cloudLayout=d3.layout.cloud().size([p.svgWidth,p.svgHeight]).words(s).font(this.layout.separated?this.fontFamily:"").padding(4).rotate(()=>~~(Math.random()*2)*90).fontSize(function(n){return p.getWordLayoutFontSize(s,n.value)}).spiral(this.layout.spiral).on("end",this.draw),this.cloudLayout.start()}addHandlers(){this.table&&this.table.addHandlers(),this.applyHandlers(!0)}removeHandlers(){this.table&&this.table.removeHandlers(),this.applyHandlers(!1)}applyHandlers(e){let t=e?"addEventListener":"removeEventListener",s=document.querySelectorAll(".cloud__action");if(s.length==3){s[0][t]("click",this.cloudExpandHandler),s[1][t]("click",this.cloudRefreshHandler),s[2][t]("click",this.cloudDownloadHandler);let r=parseInt(this.backgroundColor.slice(1),16),d=r>>16&255,i=r>>8&255,l=r&255;.2126*d+.7152*i+.0722*l>128?(s[0].classList.add("light"),s[1].classList.add("light"),s[2].classList.add("light")):(s[0].classList.remove("light"),s[1].classList.remove("light"),s[2].classList.remove("light"))}let n=document.getElementById("WordcloundManagerAdd"),a=n==null?void 0:n.querySelector("button");a&&a[t]("click",this.addWordHandler)}async wordcloudResultHandler(e){if(!e.getContent()&&!e.hasProcessedContent())return;if(!e.hasProcessedContent()){let s=e.getContentTextOnly();e.setProcessedContent(s),e.clearFulltextFields()}let t=e.getProcessedContent().split(p.wordSplitRe);for(let s of t){let n=s.replace(p.wordTrimRe,"");if(n=n.replace(/[â€˜â€™]/,"'"),this.stopwordsTruth[n.toLowerCase()]!==void 0||n.length<this.minWordLength)continue;let a=r=>{let d=r.toLocaleLowerCase(),i=this.wordMap.get(d);if(i===void 0){let l=new K(r,1);this.wordMap.set(d,l)}else i.incrementCount()};switch(this.strategy){case 0:this.isMisspelling(n,{})&&a(n);break;case 1:default:a(n);break}}this.resultsMap.has(e.id)||this.resultsMap.set(e.id,e)}isMisspelling(e,t){if(e.match(p.wordAnyNumberRe)!==null||e.match(p.wordAnyPunctuationRe)!==null)return!1;let s=!p.typo.check(e);if(s===!0)return s;let n=t[e]!==void 0,a=f.isUrl(e),r=e.match(p.wordNumericRe)!==null,d=e.match(p.wordHexRe)!==null,i=e.match(p.emailRegex)!==null,l=!isNaN(Date.parse(e));return n||r||d||i||l||a}async saveSvgAsImage(e,t){let s=new XMLSerializer().serializeToString(e),n=document.createElement("canvas"),a=document.createElement("img");n.width=p.svgWidth,n.height=p.svgHeight;let d="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(s)));a.onload=function(){n.getContext("2d",{willReadFrequently:!0}).drawImage(a,0,0);let l=n.toDataURL("image/png"),c=document.createElement("a");c.download=t,c.href=l,c.click()},a.src=d}};p.meta={title:"Website Word Cloud",category:"Visualization",version:"1.0.1",author:"InterroBot",synopsis:"create a wordcloud from website content",description:`Relive the Web 2.0 dream in all its grandeur! Website Word Cloud finds unique and
            interesting keywords in your web content and generates a word cloud, and the tools to tweak the
            visualization.


            Word selection is governed by strategy, extracting unique terms (jargon) or by frequency, which
            selects for any and all terms. The Layout option changes the aesthetic of the word cloud, while
            Min Word Length filters exactly that. For font options, you can enter any installed font on your device or
            select from a list of "web safe" fonts.
            


            InterroBot Word Cloud utilizes the d3 and d3-cloud open-source visualization libraries to bring
            your word clouds to life.`};p.layouts=[new G(1,"Rectangle","rectangular",!0),new G(2,"Elliptical","archimedean",!0)];p.baseMediaPath="";p.embedFont=p.baseMediaPath+"/fonts/Montserrat-SemiBold.woff2";p.cloudWordLayoutMemo=void 0;p.wordSplitRe=/[ â€”\-\/\|]/g;p.wordNumericRe=/^[v]?[\d\.\-â€“â€”:,<>=Ã—xX\(\)]+[MKBmkbgs]*$/g;p.wordHexRe=/^[\da-f]{6,}$/gi;p.emailRegex=/^[a-zA-Z0-9.!#$%&â€™*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;p.wordTrimRe=/^[^\da-zA-ZÃ€-É]+|[^\da-zA-ZÃ€-É]+$/g;p.wordAnyNumberRe=/\d/;p.wordAnyPunctuationRe=/\p{P}/u;p.svgWidth=1920;p.svgHeight=1080;p.svgId="d3svg";p.maxPresentationWords=250;p.wordsMinOutput=12;p.wordsMaxOutput=55;y.initialize(p);})();
/*!
 * Stopwords themselves (c)?2023:
 * Source: NLTK (python natural language toolkit)
 * Apache License 2.0
 * from nltk.corpus import stopwords
 * print(json.dumps(stopwords.words('english'), ensure_ascii=False))
 */
/**
 * @license
 * This code may be useful for anyone trying to escape the
 * JS packaging vortex (0 dependency, pure ts, single source file).
 * For anyone else, you're better off using your favorite package
 * manager and type definitions to the original Typo.js. Beware,
 * browser extension and node 'fs' support have been removed.
 * There are not many contact points if you want to add them back,
 * yourself. Look to Typo.js for pre-baked solutions.
 *
 * Typescript/in-browser port, (c) 2023, Ben Caulfield
 * Released under same license as original Typo.js implementation.
 *
 * Copyright (c) 2011, Christopher Finke
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * The name of the author may not be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE AUTHOR FINKE BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
